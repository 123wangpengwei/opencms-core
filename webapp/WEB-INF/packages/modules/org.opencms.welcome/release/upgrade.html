<?xml version="1.0" encoding="UTF-8"?>

<pages xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://www.opencms.org/dtd/6.0/xmlpage.xsd">
  <page language="en">
    <element name="body">
      <links/>
      <content><![CDATA[<h2>How to upgrade to OpenCms 5.0.0</h2><p>In case you have created a website with OpenCms 4.x, this page provides you with some simple steps how to upgrade your website to OpenCms 5.0.0. If you are already using one of the 5.0 beta or release canditade versions, most of these steps will not be necessary. </p><p>This document only describes how to upgrade templates and pages created in OpenCms 4.x. Not described here is how to upgrade OpenCms 4.x &quot;traditional&quot; style modules. Very few OpenCms installations have so far made use of the module mechanism. OpenCms 5.0 features a new &quot;simple&quot; style module type which is much easier to use, more powerful, and also better documented. We recommend using only the new &quot;simple&quot; type module style for all new OpenCms 5.0 installations. </p><h4>The upgrade process</h4><p>Upgrading should be easy if you just follow these simple steps:</p><ol><li>Check out required settings for OpenCms 5.0 <font face="Monospace">opencms.properties</font> in your 4.x installation (see below). </li><li>Export your website root folder &quot;/&quot; on your OpenCms 4.x installation. </li><li>If you have written your own Java classes for OpenCms, these need to be re-compiled against the 5.0.0 opencms.jar. <br />No changes should be required, only re-compilation. </li><li>Install OpenCms 5.0.0. <br />Make sure you have turned on the &quot;Directory translation&quot; feature. </li><li>Adjust the required settings in <font face="Monospace">opencms.properties</font> of your 5.0 installation (see below). </li><li>If you have written  your own Java classes for OpenCms, these must be placed in the standard<font face="Monospace">/classes</font> or <font face="Monospace">/lib</font> folders of the web application.<br />The <font face="Monospace">/occlasses</font> and <font face="Monospace">/oclib</font> folders of the 4.x versions do not longer exist. </li><li>Restart your OpenCms 5.0 server so that the new settings and classes are read. </li><li>Import the content you exported from the 4.x installation. </li><li>Check if everything works.</li></ol><p>This should be it.</p><h4>Adjustments in opencms.properties</h4><p>The file <font face="Monospace">/WEB-INF/config/opencms.properties</font> is where OpenCms stores most of the system settings. Some settings deal with upgrading content from OpenCms 4.x to 5.0.0. Here's a copy of that section in the <font face="Monospace">opencms.properties</font> file with the default values:</p><pre style="BORDER-RIGHT: #000000 1px solid; BORDER-TOP: #000000 1px solid; BORDER-LEFT: #000000 1px solid; BORDER-BOTTOM: #000000 1px solid; BACKGROUND-COLOR: #dddddd">#
# Backward compatibility flags.
# This should be set to true ONLY if you are migrating from 4.x to 5.0 versions of OpenCms.
#################################################################################

# &quot;Old style&quot; module locale backward compatibility support
# Enables supports for proprietary 4.x module XML locales
# Must be set to true only if old modules are used
compatibility.support.oldlocales=false

# Convert file content from 4.x to 5.x style during import
# This is needed for the correct content conversion of the import.
# Enter the URL of the OpenCms web application from which the content was exported,
# e.g. http://localhost:8080/opencms/opencms/ for a standard local Tomcat installation.
compatibility.support.import.old.webappurl=http://localhost:8080/opencms/opencms/

# List of the resource properties which should be removed when resources are imported. 
compatibility.support.import.remove.propertytags=module

# List of old web application names for conversion in editor and in import bodies.
# Example for a standard web application name: /opencms/opencms/
compatibility.support.webAppNames=

</pre><p>Depending on the OpenCms version you use, you will have to adjust the values of <font face="Monospace">compatibility.support.import.old.webappurl</font> and/or <font face="Monospace">compatibility.support.webAppNames</font>. OpenCms 4.x did place some hard coded server and context information in your page files. This will be replaced by OpenCms 5.0 with variables. To see what information you have to provide, open the body file of a page in your OpenCms 4.x installation. In OpenCms installations prior to 5.0 beta 2, these files where located in the <font face="Monospace">/content/bodys/</font> folder. Open a file in this folder that contains images you have edited with the source code editor. This will show you the page XML. What to look for will depend on your OpenCms version:</p><ul><li>If you use OpenCms 4.6 (the last official stable release), you will see a <font face="Monospace">&lt;template&gt;</font> section that is the exact copy of the source code you can edit with the WYSIWYG / Source code editor. Find an image tag (<font face="Monospace">img src</font>) and check out the path given there. It should be a full path with a server name. Let's say it's <font face="Monospace">http://www.foocompany.com/opencms/opencms/somepath/imagename.gif</font>. In that case, your old webapp URL is <font face="Monospace">http://www.foocompany.com/opencms/opencms/</font> and your webapp name is <font face="Monospace">/opencms/opencms/</font>. Place this values in the<font face="Monospace"> opencms.properties</font> file. </li><li>If you use OpenCms 4.7.7 or one of the 5.0 pre-release versions, your will find a <font face="Monospace">&lt;template&gt;</font> and a<font face="Monospace"> &lt;edittemplate&gt;</font> tag in the page XML file. Check out the <font face="Monospace">&lt;template&gt;</font> section of the file first. Find an image tag (<font face="Monospace">img src</font>) and check out the path given there. It should have the web application context hard coded, e.g. <font face="Monospace">/opencms/opencms/somepath/imagename.gif</font>. Use this as webapp name for <font face="Monospace">opencms.properties</font> . You might also find a full path with a server name. Let's say it's <font face="Monospace">http://www.foocompany.com/opencms/opencms/somepath/imagename.gif</font>. In that case, your old webapp URL is <font face="Monospace">http://www.foocompany.com/opencms/opencms/</font>. If you don't see such a full path in any of your page files, just use the default setting for webapp URL. </li></ul><h4>Things to check if something does not work</h4><p>The steps described here should happen automatically during the import to the OpenCms 5.0 version. However, if an imported page does not work as expected, you might check out this list to see how you can repair your page manually. </p><ol><li>OpenCms 5.0 has a different directory structure then the 4.x versions. All system files are now located under the <font face="Monospace">/system/</font> folder. The directory translation feature (enabled by default in the setup wizard) will automatically translate a request to an old path to the new path. For example, <font face="Monospace">/content/bodies/</font> will be translated to <font face="Monospace">/system/bodies/</font>. This is also true for the import, so files exported form one of the old directories will be imported in the new ones. Please note that some path information in page or template files will still be pointing to the old path after the import in the 5.0 system. This is o.k. as long as the directory trnaslation feature is turned on. </li><li>The encoding will be added to the XML of every page file. Old OpenCms versions did not specify the encoding with the XML tag but start with <font face="Monospace">&lt;?xml version=&quot;1.0&quot;?&gt;</font> only. The OpenCms default encoding will be added to all of this files. A valid XML start tag looks like this: <font face="Monospace">&lt;?xml version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;.</font> If your templates did not specify the encoding and the import does not correct that problem for you, you must add this manually. </li><li>OpenCms 4.x &quot;frametemplate&quot; files are analyzed if they have a <font face="Monospace">&lt;meta http-equiv=&quot;content-type&quot; ... &gt; </font>setting. This will be either added or changed to use the encoding form the OpenCms server by placing a call to the <font face="Monospace">getEncoding</font> XMLTemplate method. In the end this line should look like this: <pre>&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=]]&gt;&lt;method name=&quot;getEncoding&quot;/&gt;&lt;![CDATA[&quot;&gt;</pre>Please note that this applies only to OpenCms 4.x &quot;frametemplate&quot; files. </li><li>If a page file has no <font face="Monospace">&lt;edittemplate&gt;</font> (always true if it was exported by a 4.6 version), this will be added automatically during import.</li></ol><p>In case a page or template does not work after import, check the XML of the page file and of the template used by the page. Check all path information in the page / template and check if the replacements of the XML encoding and the &quot;content-type&quot; did work. Ensure the settings you have made in opencms.properties for the webapp name and webapp URL where correct. If not, you must correct the settings, drop the database, and repeat the setup. </p></font />]]></content>
    </element>
  </page>
</pages>
