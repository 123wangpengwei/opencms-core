<?xml version="1.0" encoding="ISO-8859-1"?>
<WORKPLACE>
<TEMPLATE>
<![CDATA[
<html>
    <script language=JavaScript>
    <!--
        top.head.helpUrl=']]><LABEL value="help.explorer.new.link"/><![CDATA[';
    //-->
    </script>

    <head>
        <script language=JavaScript>
        <!--
            function sendVfsLink(linkurl){
                sendURLString('EDITOR','URL',linkurl);
            }

            function sendLinkWithText(linktext, linkurl, linktarget, linkanchor, linkstyle, linkstyleclass){
                var sel = top.window.opener.self.document.EDITOR.EDIT_HTML.DOM.selection;
                if(linktext.length == 0){
                  if(linkurl.length >0) {
                    linktext = linkurl;
                  }
                  else if(linkanchor.length > 0) {
                    linktext = linkanchor;
                  }
                }
                if(sel != null && sel.type != "Control"){
                    var rng = sel.createRange();
                    if(rng != null){
                      var thelink = "<a ";
                      if(linkurl.length > 0) {
                        thelink += "href='"+linkurl+"' ";
                      }
                      if(linktarget.length > 0) {
                        thelink += "target='"+linktarget+"' ";
                      }
                      if(linkanchor.length > 0) {
                        thelink += "name='"+linkanchor+"' ";
                      }
                      if(linkstyle.length > 0) {
                        thelink += "style='"+linkstyle+"' ";
                      }
                      if(linkstyleclass.length > 0) {
                        thelink += "class='"+linkstyleclass+"' ";
                      }
                      thelink += ">" + linktext + "</a>";

                      rng.pasteHTML(thelink);
                    }
                }
            }

            function checkforchars(whichform){
                checkok=true;
                for(i=0;i<whichform.value.length;i++){
                    if(whichform.value.charAt(i)=="%"){
                        checkok=false;
                        alert('Unerlaubtes Zeichen in Eingabefeld:'+whichform.value.charAt(i));
                    }
                    if(whichform.value.charAt(i)=="#"){
                        checkok=false;
                        alert('Unerlaubtes Zeichen in Eingabefeld:'+whichform.value.charAt(i));
                    }
                    if(whichform.value.charAt(i)=="&"){
                        checkok=false;
                        alert('Unerlaubtes Zeichen in Eingabefeld:'+whichform.value.charAt(i));
                    }
                }
                if(checkok && check_fields()){
                    sendLinkWithText(document.NEU.NEUNAME.value, document.NEU.neulink.value,
                    document.NEU.linktarget.options[document.NEU.linktarget.selectedIndex].value,
                    document.NEU.linkanchor.value, document.NEU.linkstyle.value,
                    document.NEU.linkstyleclass.value);
                    window.close();
                }
            }

            function check_fields(){
                if(document.NEU.neulink.value=="" && document.NEU.linkanchor.value == ""){
                    alert(']]><LABEL value="input.nolinkvalue" /><![CDATA[');
                    document.NEU.neulink.focus();
                    return false;
                }
                return true;
            }


            /* Checks if the selected Text is an hyperlink */
            function checkSelection() {

              // get all links in editor
              var coll = opener.document.EDIT_HTML.DOM.all.tags("A");

              // get the current selection
              var sel = opener.document.EDIT_HTML.DOM.selection;

              // only if text is selected
              if("Text" == sel.type) {
                var range = sel.createRange();

                for(i = 0; i < coll.length; i++) {

                  //create range on whole text
                  var mainrange = opener.document.EDIT_HTML.DOM.body.createTextRange();

                  //and move range to the current A-element
                  mainrange.moveToElementText(coll[i]);

                  // compare the selection with the current range
                  if(range.isEqual(mainrange)) {

                    // it is the same!
                    fillTextfields(coll[i], range.text);
                    break;
                  }
                }
                document.forms["NEU"].elements["NEUNAME"].value = range.text;
              }
            }


            function fillTextfields(el, linkname) {

              document.forms["NEU"].elements["NEUNAME"].value = linkname;
              document.forms["NEU"].elements["neulink"].value = el.href;
              document.forms["NEU"].elements["linkanchor"].value = el.name;
              document.forms["NEU"].elements["linkstyle"].value = el.style.cssText;
              document.forms["NEU"].elements["linkstyleclass"].value = el.className;

              if(el.target == "_self") {
                document.forms["NEU"].elements["linktarget"].selectedIndex = 0;
              }
              else if(el.target == "_blank") {
                document.forms["NEU"].elements["linktarget"].selectedIndex = 1;
              }
              else if(el.target == "_top") {
                document.forms["NEU"].elements["linktarget"].selectedIndex = 2;
              }


            }
        //-->
        </script>

        <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=]]><METHOD name="getEncoding"/><![CDATA[">
        <title>]]><LABEL value="title.newlink" /><![CDATA[</title>
        <link rel=stylesheet type="text/css" href="]]><method name="resourcesUri">format.css</method><![CDATA[">
        <script language="JavaScript" type="text/javascript" src="]]><method name="scriptsUri">opencms.js</method><![CDATA["></script>
        <script language="JavaScript" type="text/javascript" src="]]><method name="scriptsUri">opencms_edithtml.js</method><![CDATA["></script>
    </head>

    <body bgcolor="#ffffff" background="]]><METHOD name="resourcesUri">bg_weiss.gif</METHOD><![CDATA[" bgproperties=fixed marginwidth=0 marginheight=0 leftmargin=0 topmargin=0 onLoad="self.focus();checkSelection();" onUnload="if(treewin!=null)treewin.close();">
        <form name=NEU >
            <table border=0 cellspacing=0 cellpadding=5 width=100% height=100%>
                <tr>
                    <td colspan=3 class=leerzeile>&nbsp;</td>
                </tr>
                <tr>
                    <td class=formular width=35%>]]><LABEL value="input.linkname" /><![CDATA[:</td>
                    <td class=dialogtxt>
                        <input type="text" name="NEUNAME" class="textfeld3" size="30" />
                    </td>
                                        <td class=formular>&nbsp;</td>
                </tr>
                <tr>
                    <td class=formular>]]><LABEL value="input.linkto" /><![CDATA[:</td>
                    <td class=dialogtxt>
                        <input type="text" name="neulink" class="textfeld3" size="30" value="http://" />
                    </td>
                    <td class=formular><a href="javascript:treewin=opensmallwin('folder_tree.html?foldertree=/&formname=NEU&variable=neulink&onlineselect=yes&viewfile=yes', 'explorer_viewer', 300, 400),treewin.focus();"><img src="]]><METHOD name="resourcesUri">ic_file_folder.gif</METHOD><![CDATA[" border="0" alt="]]><LABEL value="label.selectfolder" /><![CDATA["></a></td>
                </tr>
            <tr>
                    <td class=formular>]]><LABEL value="input.linkanchor" /><![CDATA[:</td>
                    <td class=dialogtxt>
                        <input type="text" name="linkanchor" class="textfeld3" size="15" />
                    </td>
                    <td class=formular>&nbsp;</td>
                </tr>
            <tr>
                    <td class=formular>]]><LABEL value="input.linkstyle" /><![CDATA[:</td>
                    <td class=dialogtxt>
                        <input type="text" name="linkstyle" class="textfeld3" size="15"  />
                    </td>
                                        <td class=formular>&nbsp;</td>
                                </tr>
                <tr>
                    <td class=formular>]]><LABEL value="input.linkstyleclass" /><![CDATA[:</td>
                    <td class=dialogtxt>
                        <input type="text" name="linkstyleclass" class="textfeld3" size="15" />
                    </td>
                                        <td class=formular>&nbsp;</td>
                </tr>
                <tr>
                    <td class=formular>]]><LABEL value="input.linktarget" /><![CDATA[:</td>
                    <td class=dialogtxt>
                      <select name="linktarget" id="linktarget" size="1" style="width:150px">
                        <option value="_self">]]><LABEL value="input.linktargetself" /><![CDATA[</option>
                        <option value="_blank">]]><LABEL value="input.linktargetblank" /><![CDATA[</option>
                        <option value="_top">]]><LABEL value="input.linktargettop" /><![CDATA[</option>
                      </select>
                    </td>
                                        <td class=formular>&nbsp;</td>
                </tr>
                <tr>
                    <td colspan=3 class=leerzeile>&nbsp;</td>
                </tr>
                <tr>
                    <td colspan=3 class=formular>
                        <table cellspacing=0 cellpadding=5 width=100%>
                            <tr>
                                <td class=formular align=middle width=20%><INPUT class=button width=100 type="button" value="]]><LABEL value="button.ok" /><![CDATA[" id=OK name=OK onClick="checkforchars(document.NEU.NEUNAME);"></td>
                                <td class=formular align=middle width=20%><INPUT class=button width=100 type="button" value="]]><LABEL value="button.cancel" /><![CDATA[" id=CANCEL name=CANCEL onClick="window.close();"></td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
        </form>
    </body>
</html>
]]>
</TEMPLATE>

</WORKPLACE>


