<%@ page import="
	org.opencms.workplace.CmsDialog,
	org.opencms.main.*,
	org.opencms.file.CmsResource"
    buffer="none" 
%>
<%	
	// initialize the workplace class
	CmsDialog wp = new CmsDialog(pageContext, request, response);	
%>
<%= wp.htmlStart("administration/index.html") %>
<%= wp.bodyStart(null) %>
    <%= wp.dialogStart() %>
    <%= wp.dialogContentStart(wp.getJsp().property(I_CmsConstants.C_PROPERTY_TITLE)) %>

<%	
    // 1. get "gallerytypename" by reading the folderpath
    String galleryTypeName = null;
    if (wp.useNewStyle()) {
         galleryTypeName = CmsResource.getName(CmsResource.getFolderPath(wp.getAdminTool().getLink()));
    } else {
         galleryTypeName = CmsResource.getName(CmsResource.getFolderPath(wp.getJsp().getRequestContext().getUri()));
    }
    if (galleryTypeName.endsWith("/")) {
    	galleryTypeName = galleryTypeName.substring(0, galleryTypeName.length()-1);
    }
    // 2. Set in user settings
    wp.getSettings().setGalleryType(galleryTypeName);
%>
    <table border="1" cellpadding="0" cellspacing="0" width="100%"><tr><td>
        <iframe name="report" id="report" src="<%=wp.getJsp().link("/system/workplace/views/explorer/explorer_files.jsp?resource=/system/workplace/&mode=galleryview")%>" style="width:100%; height:400px; padding: 0; margin: 0;" frameborder="0"></iframe>
    </td></tr></table>    

    <%= wp.dialogContentEnd() %>
    <%= wp.dialogEnd() %>
<%= wp.bodyEnd() %>
<%=wp.htmlEnd() %>
