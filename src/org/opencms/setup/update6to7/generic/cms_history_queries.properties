CMS_HISTORY_PROJECTRESOURCES=\
INSERT INTO CMS_HISTORY_PROJECTRESOURCES \
(CMS_HISTORY_PROJECTRESOURCES.PUBLISH_TAG\, \
CMS_HISTORY_PROJECTRESOURCES.PROJECT_ID\, \
CMS_HISTORY_PROJECTRESOURCES.RESOURCE_PATH) \
\
SELECT \
  CMS_BACKUP_PROJECTRESOURCES.PUBLISH_TAG\, \
  TEMP_PROJECT_UUIDS.PROJECT_UUID AS PROJECT_ID\, \
  CMS_BACKUP_PROJECTRESOURCES.RESOURCE_PATH \
FROM CMS_BACKUP_PROJECTRESOURCES \
LEFT OUTER JOIN TEMP_PROJECT_UUIDS ON TEMP_PROJECT_UUIDS.PROJECT_ID = CMS_BACKUP_PROJECTRESOURCES.PROJECT_ID


CMS_HISTORY_PROPERTIES=\
INSERT INTO CMS_HISTORY_PROPERTIES \
(STRUCTURE_ID\, \
PROPERTYDEF_ID\, \
PROPERTY_MAPPING_ID\, \
PROPERTY_MAPPING_TYPE\, \
PROPERTY_VALUE\, \
PUBLISH_TAG) \
\
SELECT DISTINCT \
  CMS_BACKUP_STRUCTURE.STRUCTURE_ID\, \
  CMS_BACKUP_PROPERTIES.PROPERTYDEF_ID\, \
  CMS_BACKUP_PROPERTIES.PROPERTY_MAPPING_ID\, \
  CMS_BACKUP_PROPERTIES.PROPERTY_MAPPING_TYPE\, \
  CMS_BACKUP_PROPERTIES.PROPERTY_VALUE\, \
  CMS_BACKUP_PROPERTIES.PUBLISH_TAG \
FROM CMS_BACKUP_PROPERTIES \
LEFT OUTER JOIN CMS_BACKUP_STRUCTURE ON CMS_BACKUP_STRUCTURE.BACKUP_ID = CMS_BACKUP_PROPERTIES.BACKUP_ID


CMS_HISTORY_PROPERTYDEF=\
INSERT INTO CMS_HISTORY_PROPERTYDEF \
(CMS_HISTORY_PROPERTYDEF.PROPERTYDEF_ID\, \
CMS_HISTORY_PROPERTYDEF.PROPERTYDEF_NAME\, \
CMS_HISTORY_PROPERTYDEF.PROPERTYDEF_TYPE) \
\
SELECT DISTINCT \
  CMS_BACKUP_PROPERTYDEF.PROPERTYDEF_ID\, \
  CMS_BACKUP_PROPERTYDEF.PROPERTYDEF_NAME\, \
  0 AS PROPERTYDEF_TYPE \
FROM CMS_BACKUP_PROPERTYDEF


CMS_HISTORY_RESOURCES=\
INSERT INTO CMS_HISTORY_RESOURCES \
(CMS_HISTORY_RESOURCES.RESOURCE_ID\, \
CMS_HISTORY_RESOURCES.RESOURCE_TYPE\, \
CMS_HISTORY_RESOURCES.RESOURCE_FLAGS\, \
CMS_HISTORY_RESOURCES.RESOURCE_STATE\, \
CMS_HISTORY_RESOURCES.RESOURCE_SIZE\, \
CMS_HISTORY_RESOURCES.DATE_CONTENT\, \
CMS_HISTORY_RESOURCES.SIBLING_COUNT\, \
CMS_HISTORY_RESOURCES.DATE_CREATED\, \
CMS_HISTORY_RESOURCES.DATE_LASTMODIFIED\, \
CMS_HISTORY_RESOURCES.USER_CREATED\, \
CMS_HISTORY_RESOURCES.USER_LASTMODIFIED\, \
CMS_HISTORY_RESOURCES.PROJECT_LASTMODIFIED\, \
CMS_HISTORY_RESOURCES.PUBLISH_TAG\, \
CMS_HISTORY_RESOURCES.RESOURCE_VERSION) \
\
SELECT DISTINCT \
  CMS_BACKUP_RESOURCES.RESOURCE_ID\, \
  CMS_BACKUP_RESOURCES.RESOURCE_TYPE\, \
  CMS_BACKUP_RESOURCES.RESOURCE_FLAGS\, \
  CMS_BACKUP_RESOURCES.RESOURCE_STATE\, \
  CMS_BACKUP_RESOURCES.RESOURCE_SIZE\, \
  0 AS DATE_CONTENT\, \
  CMS_BACKUP_RESOURCES.SIBLING_COUNT\, \
  CMS_BACKUP_RESOURCES.DATE_CREATED\, \
  CMS_BACKUP_RESOURCES.DATE_LASTMODIFIED\, \
  CMS_BACKUP_RESOURCES.USER_CREATED\, \
  CMS_BACKUP_RESOURCES.USER_LASTMODIFIED\, \
  TEMP_PROJECT_UUIDS.PROJECT_UUID AS PROJECT_LASTMODIFIED\, \
  CMS_BACKUP_RESOURCES.PUBLISH_TAG\, \
  CMS_BACKUP_RESOURCES.VERSION_ID \
FROM CMS_BACKUP_RESOURCES \
LEFT OUTER JOIN TEMP_PROJECT_UUIDS ON TEMP_PROJECT_UUIDS.PROJECT_ID = CMS_BACKUP_RESOURCES.PROJECT_LASTMODIFIED


CMS_HISTORY_STRUCTURE=\
INSERT INTO CMS_HISTORY_STRUCTURE \
(CMS_HISTORY_STRUCTURE.PUBLISH_TAG\, \
CMS_HISTORY_STRUCTURE.VERSION\, \
CMS_HISTORY_STRUCTURE.STRUCTURE_ID\, \
CMS_HISTORY_STRUCTURE.RESOURCE_ID\, \
CMS_HISTORY_STRUCTURE.PARENT_ID\, \
CMS_HISTORY_STRUCTURE.RESOURCE_PATH\, \
CMS_HISTORY_STRUCTURE.STRUCTURE_STATE\, \
CMS_HISTORY_STRUCTURE.DATE_RELEASED\, \
CMS_HISTORY_STRUCTURE.DATE_EXPIRED\, \
CMS_HISTORY_STRUCTURE.STRUCTURE_VERSION) \
(\
(SELECT DISTINCT \
  CMS_BACKUP_STRUCTURE.PUBLISH_TAG\, \
  CMS_BACKUP_STRUCTURE.VERSION_ID\, \
  CMS_BACKUP_STRUCTURE.STRUCTURE_ID\, \
  CMS_BACKUP_STRUCTURE.RESOURCE_ID\, \
  CMS_ONLINE_STRUCTURE.PARENT_ID\, \
  CMS_BACKUP_STRUCTURE.RESOURCE_PATH\, \
  CMS_BACKUP_STRUCTURE.STRUCTURE_STATE\, \
  CMS_BACKUP_STRUCTURE.DATE_RELEASED\, \
  CMS_BACKUP_STRUCTURE.DATE_EXPIRED\, \
  CMS_BACKUP_STRUCTURE.VERSION_ID AS STRUCTURE_VERSION \
FROM CMS_BACKUP_STRUCTURE\, CMS_ONLINE_STRUCTURE \
WHERE CMS_BACKUP_STRUCTURE.STRUCTURE_ID = CMS_ONLINE_STRUCTURE.STRUCTURE_ID) \
\
UNION \
\
(SELECT DISTINCT \
  CMS_BACKUP_STRUCTURE.PUBLISH_TAG\, \
  CMS_BACKUP_STRUCTURE.VERSION_ID\, \
  CMS_BACKUP_STRUCTURE.STRUCTURE_ID\, \
  CMS_BACKUP_STRUCTURE.RESOURCE_ID\, \
  CMS_ONLINE_STRUCTURE.PARENT_ID\, \
  CMS_BACKUP_STRUCTURE.RESOURCE_PATH\, \
  CMS_BACKUP_STRUCTURE.STRUCTURE_STATE\, \
  CMS_BACKUP_STRUCTURE.DATE_RELEASED\, \
  CMS_BACKUP_STRUCTURE.DATE_EXPIRED\, \
  CMS_BACKUP_STRUCTURE.VERSION_ID AS STRUCTURE_VERSION \
FROM CMS_BACKUP_STRUCTURE\, CMS_ONLINE_STRUCTURE \
WHERE CMS_BACKUP_STRUCTURE.STRUCTURE_ID \
NOT IN \
(SELECT CMS_ONLINE_STRUCTURE.STRUCTURE_ID FROM CMS_ONLINE_STRUCTURE) \
AND CMS_ONLINE_STRUCTURE.RESOURCE_PATH = '/') \
)

Q_SELECT_COUNT_HISTORY_TABLE=\
SELECT COUNT(1) AS COUNT FROM ${tablename}