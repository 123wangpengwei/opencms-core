#
# The pattern _${PROJECT}_ in table names is replaced by the SqlManager with 
# "_ONLINE_" or "_OFFLINE_" to choose the right database tables for
# SQL queries that are project dependent!
#

#
# Project table attribs
#
C_PROJECTS_PUBLISH_TAG_0=PUBLISH_TAG
C_PROJECTS_PROJECT_ID_0=PROJECT_ID
C_PROJECTS_USER_ID_0=USER_ID
C_PROJECTS_GROUP_ID_0=GROUP_ID
C_PROJECTS_MANAGERGROUP_ID_0=MANAGERGROUP_ID
C_PROJECTS_PROJECT_NAME_0=PROJECT_NAME
C_PROJECTS_PROJECT_DESCRIPTION_0=PROJECT_DESCRIPTION
C_PROJECTS_PROJECT_FLAGS_0=PROJECT_FLAGS
C_PROJECTS_DATE_CREATED_0=DATE_CREATED
C_PROJECTS_PROJECT_TYPE_0=PROJECT_TYPE
C_PROJECTS_PROJECT_OU_0=PROJECT_OU
C_PROJECT_PUBLISHDATE_0=PROJECT_PUBLISHDATE
C_PROJECT_PUBLISHED_BY_0=PROJECT_PUBLISHED_BY
	
#
# Project queries
#
C_PROJECTS_CREATE_10=\
INSERT INTO CMS_PROJECTS \
	(PROJECT_ID,\
	USER_ID,\
	GROUP_ID,\
	MANAGERGROUP_ID,\
	PROJECT_NAME,\
	PROJECT_DESCRIPTION,\
	PROJECT_FLAGS,\
	DATE_CREATED,\
	PROJECT_TYPE,\
	PROJECT_OU)\
VALUES \
	(?,?,?,?,?,?,?,?,?,?)
	
C_PROJECTS_WRITE_6=\
UPDATE \
	CMS_PROJECTS \
SET \
	PROJECT_DESCRIPTION=?,\
	GROUP_ID=?,\
	MANAGERGROUP_ID=?,\
	PROJECT_FLAGS=?,\
	PROJECT_TYPE=? \
WHERE \
	PROJECT_ID=?
	
C_PROJECTS_READ_1=\
SELECT \
	PROJECT_ID,\
	PROJECT_NAME,\
	PROJECT_DESCRIPTION,\
	USER_ID,\
	GROUP_ID,\
	MANAGERGROUP_ID,\
	PROJECT_FLAGS,\
	DATE_CREATED,\
	PROJECT_TYPE,\
	PROJECT_OU \
FROM \
	CMS_PROJECTS \
WHERE \
	PROJECT_ID=? \
ORDER BY \
	PROJECT_OU, PROJECT_NAME

C_PROJECTS_READ_BYUSER_1=\
SELECT \
	PROJECT_ID,\
	PROJECT_NAME,\
	PROJECT_DESCRIPTION,\
	USER_ID,\
	GROUP_ID,\
	MANAGERGROUP_ID,\
	PROJECT_FLAGS,\
	DATE_CREATED,\
	PROJECT_TYPE,\
	PROJECT_OU \
FROM \
	CMS_PROJECTS \
WHERE \
	USER_ID=? \
	AND PROJECT_FLAGS=0 \
ORDER BY \
	PROJECT_OU, PROJECT_NAME
	
	
C_PROJECTS_READ_BYGROUP_2=\
SELECT \
	PROJECT_ID,\
	PROJECT_NAME,\
	PROJECT_DESCRIPTION,\
	USER_ID,\
	GROUP_ID,\
	MANAGERGROUP_ID,\
	PROJECT_FLAGS,\
	DATE_CREATED,\
	PROJECT_TYPE,\
	PROJECT_OU \
FROM \
	CMS_PROJECTS \
WHERE \
	(GROUP_ID=? OR MANAGERGROUP_ID=?) \
	AND PROJECT_FLAGS=0 \
ORDER BY \
	PROJECT_OU, PROJECT_NAME
	
	
C_PROJECTS_READ_BYOU_1=\
SELECT \
	PROJECT_ID,\
	PROJECT_NAME,\
	PROJECT_DESCRIPTION,\
	USER_ID,\
	GROUP_ID,\
	MANAGERGROUP_ID,\
	PROJECT_FLAGS,\
	DATE_CREATED,\
	PROJECT_TYPE,\
	PROJECT_OU \
FROM \
	CMS_PROJECTS \
WHERE \
	PROJECT_OU LIKE ? \
ORDER BY \
	PROJECT_OU, PROJECT_NAME
	
	
C_PROJECTS_READ_BYMANAGER_1=\
SELECT \
	PROJECT_ID,\
	PROJECT_NAME,\
	PROJECT_DESCRIPTION,\
	USER_ID,\
	GROUP_ID,\
	MANAGERGROUP_ID,\
	PROJECT_FLAGS,\
	DATE_CREATED,\
	PROJECT_TYPE,\
	PROJECT_OU \
FROM \
	CMS_PROJECTS \
WHERE \
	MANAGERGROUP_ID=? \
    AND PROJECT_FLAGS=0 \
ORDER BY \
	PROJECT_OU, PROJECT_NAME
                    
                    
C_PROJECTS_READ_BYNAME_2=\
SELECT \
	PROJECT_ID,\
	PROJECT_NAME,\
	PROJECT_DESCRIPTION,\
	USER_ID,\
	GROUP_ID,\
	MANAGERGROUP_ID,\
	PROJECT_FLAGS,\
	DATE_CREATED,\
	PROJECT_TYPE,\
	PROJECT_OU \
FROM \
	CMS_PROJECTS \
WHERE \
	PROJECT_NAME=? \
	AND PROJECT_OU=? \
ORDER BY \
	PROJECT_OU, PROJECT_NAME                          
                    
	
C_PROJECTS_DELETE_1=\
DELETE FROM \
	CMS_PROJECTS \
WHERE \
	PROJECT_ID=?
                 
                    
#
# Project history queries
#
C_PROJECTS_HISTORY_CREATE=\
INSERT INTO CMS_HISTORY_PROJECTS \
	(PUBLISH_TAG,\
	PROJECT_ID,\
	PROJECT_NAME,\
	PROJECT_PUBLISHDATE,\
	PROJECT_PUBLISHED_BY,\
	USER_ID,\
	GROUP_ID,\
	MANAGERGROUP_ID,\
	PROJECT_DESCRIPTION,\
	DATE_CREATED,\
	PROJECT_TYPE,\
	PROJECT_OU) \
VALUES \
	(?,?,?,?,?,?,?,?,?,?,?,?)
                         
                         
C_PROJECTS_HISTORY_READ=\
SELECT \
	PUBLISH_TAG,\
	PROJECT_ID,\
	PROJECT_NAME,\
	PROJECT_PUBLISHDATE,\
	PROJECT_PUBLISHED_BY,\
	USER_ID,\
	GROUP_ID,\
	MANAGERGROUP_ID,\
	PROJECT_DESCRIPTION,\
	DATE_CREATED,\
	PROJECT_TYPE,\
	PROJECT_OU \
FROM \
	CMS_HISTORY_PROJECTS \
WHERE \
	PUBLISH_TAG=?
                         
                                 
C_PROJECTS_HISTORY_READ_ALL=\
SELECT \
	PUBLISH_TAG,\
	PROJECT_ID,\
	PROJECT_NAME,\
	PROJECT_PUBLISHDATE,\
	PROJECT_PUBLISHED_BY,\
	PROJECT_DESCRIPTION,\
	USER_ID,\
	GROUP_ID,\
	MANAGERGROUP_ID,\
	DATE_CREATED,\
	PROJECT_TYPE,\
	PROJECT_OU \
FROM \
	CMS_HISTORY_PROJECTS \
ORDER BY \
	PUBLISH_TAG DESC
    
                         
C_PROJECTRESOURCES_HISTORY_CREATE=\
INSERT INTO CMS_HISTORY_PROJECTRESOURCES \
	(PUBLISH_TAG,\
	PROJECT_ID,\
	RESOURCE_PATH) \
VALUES \
	(?,?,?)
                           
                                 
C_PROJECTRESOURCES_HISTORY_READ=\
SELECT \
	RESOURCE_PATH \
FROM \
	CMS_HISTORY_PROJECTRESOURCES \
WHERE \
	PUBLISH_TAG=?
	
	
#
# Project resource queries
#
C_PROJECTRESOURCES_CREATE_2=\
INSERT INTO CMS_PROJECTRESOURCES \
	(PROJECT_ID,RESOURCE_PATH) \
VALUES \
	(?,?)


C_PROJECTRESOURCES_DELETE_2=\
DELETE FROM \
	CMS_PROJECTRESOURCES \
WHERE \
	PROJECT_ID=? \
	AND RESOURCE_PATH=?
                          
                          
C_PROJECTRESOURCES_DELETEALL_1=\
DELETE FROM \
	CMS_PROJECTRESOURCES \
WHERE \
	PROJECT_ID=?

	
C_PROJECTRESOURCES_READ_2=\
SELECT \
	RESOURCE_PATH \
FROM \
	CMS_PROJECTRESOURCES \
WHERE \
	PROJECT_ID=? \
	AND RESOURCE_PATH=?
	
	
C_PROJECTRESOURCES_READ_BY_ID_1=\
SELECT \
	RESOURCE_PATH \
FROM \
	CMS_PROJECTRESOURCES \
WHERE \
	PROJECT_ID=?
	
#
# CMS_RESOURCE_LOCKS queries
#
C_RESOURCE_LOCKS_READALL=\
SELECT \
	RESOURCE_PATH,\
	USER_ID,\
	PROJECT_ID,\
	LOCK_TYPE \
FROM \
	CMS_RESOURCE_LOCKS

C_RESOURCE_LOCKS_DELETEALL=\
DELETE \
FROM \
	CMS_RESOURCE_LOCKS

C_RESOURCE_LOCK_WRITE=\
INSERT INTO CMS_RESOURCE_LOCKS \
	(RESOURCE_PATH, USER_ID, PROJECT_ID, LOCK_TYPE) \
VALUES \
	(?,?,?,?)
	

# CMS_RESOURCE_LOCKS column names: 
C_RESOURCE_LOCKS_RESOURCE_PATH=RESOURCE_PATH
C_RESOURCE_LOCKS_USER_ID=USER_ID
C_RESOURCE_LOCKS_PROJECT_ID=PROJECT_ID
C_RESOURCE_LOCKS_LOCK_TYPE=LOCK_TYPE

						   
#
# Database table attribs required to create a valid resource instance
#
C_RESOURCES_RESOURCE_ID=RESOURCE_ID
C_RESOURCES_STRUCTURE_ID=STRUCTURE_ID
C_RESOURCES_PUBLISH_TAG=PUBLISH_TAG
C_RESOURCES_HISTORY_VERSION=VERSION
C_RESOURCES_HISTORY_PARENTID=PARENT_ID
C_RESOURCES_VERSION=RESOURCE_VERSION
C_RESOURCES_STRUCTURE_VERSION=STRUCTURE_VERSION
C_RESOURCES_RESOURCE_TYPE=RESOURCE_TYPE
C_RESOURCES_RESOURCE_FLAGS=RESOURCE_FLAGS
C_RESOURCES_RESOURCE_PATH=RESOURCE_PATH
C_RESOURCES_GROUP_NAME=GROUP_NAME
C_RESOURCES_PROJECT_LASTMODIFIED=PROJECT_LASTMODIFIED
C_PROJECT_ID_RESOURCES=CMS_OFFLINE_RESOURCES.PROJECT_LASTMODIFIED
C_RESOURCE_FLAGS=RESOURCE_FLAGS
C_RESOURCES_STATE=RESOURCE_STATE
C_RESOURCES_DATE_CREATED=DATE_CREATED
C_RESOURCES_DATE_LASTMODIFIED=DATE_LASTMODIFIED
C_RESOURCES_DATE_RELEASED=DATE_RELEASED
C_RESOURCES_DATE_EXPIRED=DATE_EXPIRED
C_RESOURCES_SIZE=RESOURCE_SIZE
C_RESOURCES_DATE_CONTENT=DATE_CONTENT
C_RESOURCES_USER_CREATED=USER_CREATED
C_RESOURCES_USER_LASTMODIFIED=USER_LASTMODIFIED
C_RESOURCES_FILE_CONTENT=FILE_CONTENT
C_RESOURCES_STRUCTURE_STATE=STRUCTURE_STATE
C_RESOURCES_SIBLING_COUNT=SIBLING_COUNT

#
# these strings are used as replacements for ${XXX} patterns in SQL statements when the properties hash is loaded
#

# patterns for insert statements
C_TABLE_RESOURCES_ATTRIBS=\
	RESOURCE_ID,\
	RESOURCE_TYPE,\
	RESOURCE_FLAGS,\
	DATE_CREATED,\
	USER_CREATED,\
	DATE_LASTMODIFIED,\
	USER_LASTMODIFIED,\
	RESOURCE_STATE,\
	RESOURCE_SIZE,\
	DATE_CONTENT,\
	PROJECT_LASTMODIFIED,\
	SIBLING_COUNT
C_TABLE_RESOURCES_VALUES=?,?,?,?,?,?,?,?,?,?,?,?

C_TABLE_STRUCTURE_ATTRIBS=\
	STRUCTURE_ID,\
	RESOURCE_ID,\
	RESOURCE_PATH,\
	STRUCTURE_STATE,\
	DATE_RELEASED,\
	DATE_EXPIRED
C_TABLE_STRUCTURE_VALUES=?,?,?,?,?,?

# patterns for statements to select resources/folders (= selections without content)
# THINGS TO KNOW: don't select the project-ID attrib. of the structure table per default!
# There are cases, where the project-ID attrib. of the project-resources tab. is used
# as the project-ID!
C_RESOURCES_SELECT_ATTRIBS=\
    CMS_${PROJECT}_STRUCTURE.STRUCTURE_ID,\
	CMS_${PROJECT}_STRUCTURE.RESOURCE_ID,\
	CMS_${PROJECT}_STRUCTURE.RESOURCE_PATH,\
	CMS_${PROJECT}_STRUCTURE.STRUCTURE_STATE,\
	CMS_${PROJECT}_STRUCTURE.DATE_RELEASED,\
	CMS_${PROJECT}_STRUCTURE.DATE_EXPIRED,\
	CMS_${PROJECT}_STRUCTURE.STRUCTURE_VERSION,\
	CMS_${PROJECT}_RESOURCES.RESOURCE_ID,\
	CMS_${PROJECT}_RESOURCES.RESOURCE_TYPE,\
	CMS_${PROJECT}_RESOURCES.RESOURCE_FLAGS,\
	CMS_${PROJECT}_RESOURCES.RESOURCE_STATE,\
	CMS_${PROJECT}_RESOURCES.DATE_CREATED,\
	CMS_${PROJECT}_RESOURCES.DATE_LASTMODIFIED,\
	CMS_${PROJECT}_RESOURCES.USER_CREATED,\
	CMS_${PROJECT}_RESOURCES.USER_LASTMODIFIED,\
	CMS_${PROJECT}_RESOURCES.PROJECT_LASTMODIFIED LOCKED_IN_PROJECT,\
	CMS_${PROJECT}_RESOURCES.RESOURCE_SIZE,\
	CMS_${PROJECT}_RESOURCES.DATE_CONTENT,\
	CMS_${PROJECT}_RESOURCES.SIBLING_COUNT,\
	CMS_${PROJECT}_RESOURCES.RESOURCE_VERSION
	
C_RESOURCES_SELECT_TABLES=CMS_${PROJECT}_STRUCTURE,CMS_${PROJECT}_RESOURCES

C_RESOURCES_SELECT_ATTRIBS_HISTORY=\
	CMS_HISTORY_STRUCTURE.PUBLISH_TAG, \
	CMS_HISTORY_STRUCTURE.VERSION,\
	CMS_HISTORY_STRUCTURE.STRUCTURE_ID,\
	CMS_HISTORY_STRUCTURE.RESOURCE_PATH,\
	CMS_HISTORY_STRUCTURE.STRUCTURE_STATE,\
	CMS_HISTORY_STRUCTURE.DATE_RELEASED,\
	CMS_HISTORY_STRUCTURE.DATE_EXPIRED,\
	CMS_HISTORY_STRUCTURE.PARENT_ID,\
	CMS_HISTORY_RESOURCES.RESOURCE_ID,\
	CMS_HISTORY_RESOURCES.RESOURCE_TYPE,\
	CMS_HISTORY_RESOURCES.RESOURCE_FLAGS,\
	CMS_HISTORY_RESOURCES.RESOURCE_STATE,\
	CMS_HISTORY_RESOURCES.DATE_CREATED,\
	CMS_HISTORY_RESOURCES.DATE_LASTMODIFIED,\
	CMS_HISTORY_RESOURCES.USER_CREATED,\
	CMS_HISTORY_RESOURCES.USER_LASTMODIFIED,\
	CMS_HISTORY_RESOURCES.PROJECT_LASTMODIFIED,\
	CMS_HISTORY_RESOURCES.RESOURCE_SIZE,\
	CMS_HISTORY_RESOURCES.DATE_CONTENT,\
	CMS_HISTORY_RESOURCES.SIBLING_COUNT
	
C_RESOURCES_SELECT_TABLES_HISTORY=CMS_HISTORY_STRUCTURE,CMS_HISTORY_RESOURCES

C_FILES_SELECT_TABLES_OFFLINE=\
CMS_OFFLINE_STRUCTURE,\
CMS_OFFLINE_RESOURCES,\
CMS_OFFLINE_CONTENTS

C_FILES_SELECT_TABLES_ONLINE=\
CMS_ONLINE_STRUCTURE,\
CMS_ONLINE_RESOURCES,\
CMS_CONTENTS

C_FILES_SELECT_TABLES_HISTORY=\
CMS_HISTORY_RESOURCES,\
CMS_HISTORY_STRUCTURE,\
CMS_CONTENTS

C_JOIN_STRUCTURE_RESOURCE=CMS_${PROJECT}_STRUCTURE.RESOURCE_ID=CMS_${PROJECT}_RESOURCES.RESOURCE_ID
C_JOIN_RESOURCE_STRUCTURE=CMS_${PROJECT}_RESOURCES.RESOURCE_ID=CMS_${PROJECT}_STRUCTURE.RESOURCE_ID
C_JOIN_STRUCTURE_RESOURCE_HISTORY=CMS_HISTORY_STRUCTURE.RESOURCE_ID=CMS_HISTORY_RESOURCES.RESOURCE_ID AND CMS_HISTORY_STRUCTURE.PUBLISH_TAG=CMS_HISTORY_RESOURCES.PUBLISH_TAG

C_JOIN_RESOURCE_OFFLINE_FILE=CMS_OFFLINE_CONTENTS.RESOURCE_ID=CMS_OFFLINE_RESOURCES.RESOURCE_ID
C_JOIN_RESOURCE_ONLINE_FILE=CMS_CONTENTS.RESOURCE_ID=CMS_ONLINE_RESOURCES.RESOURCE_ID AND CMS_CONTENTS.ONLINE_FLAG=1
C_JOIN_RESOURCE_FILE_HISTORY=CMS_HISTORY_RESOURCES.RESOURCE_ID=CMS_CONTENTS.RESOURCE_ID AND CMS_CONTENTS.PUBLISH_TAG_TO>=CMS_HISTORY_RESOURCES.PUBLISH_TAG AND CMS_CONTENTS.PUBLISH_TAG_FROM<=CMS_HISTORY_RESOURCES.PUBLISH_TAG


#
# SQL statements
#
C_RESOURCE_UPDATE_CONTENT_DATE=\
UPDATE \
	CMS_${PROJECT}_RESOURCES \
SET \
	DATE_CONTENT=? \
WHERE \
	RESOURCE_ID=?

C_RESOURCES_UNMARK=\
UPDATE \
	CMS_OFFLINE_RESOURCES \
SET \
	PROJECT_LASTMODIFIED='00000000-0000-0000-0000-000000000000' \
WHERE \
	PROJECT_LASTMODIFIED=?
                    
                    
C_RESOURCES_WRITE=\
INSERT INTO CMS_${PROJECT}_RESOURCES \
	(${C_TABLE_RESOURCES_ATTRIBS},RESOURCE_VERSION) \
VALUES \
	(${C_TABLE_RESOURCES_VALUES},?)


C_RESOURCES_READ_VERSIONS=\
SELECT \
    CMS_${PROJECT}_RESOURCES.RESOURCE_VERSION,\
	CMS_${PROJECT}_STRUCTURE.STRUCTURE_VERSION \
FROM \
	CMS_${PROJECT}_RESOURCES,\
	CMS_${PROJECT}_STRUCTURE \
WHERE \
	CMS_${PROJECT}_STRUCTURE.STRUCTURE_ID=? \
	AND CMS_${PROJECT}_STRUCTURE.RESOURCE_ID=CMS_${PROJECT}_RESOURCES.RESOURCE_ID
   
	
C_RESOURCES_UPDATE_RESOURCE_VERSION=\
UPDATE \
	CMS_${PROJECT}_RESOURCES \
SET \
	RESOURCE_VERSION = ? \
WHERE \
	RESOURCE_ID = ?
	 
C_RESOURCES_UPDATE_STRUCTURE_VERSION=\
UPDATE \
	CMS_${PROJECT}_STRUCTURE \
SET \
	STRUCTURE_VERSION = ? \
WHERE \
	STRUCTURE_ID = ?
	 

C_STRUCTURE_WRITE=\
INSERT INTO CMS_${PROJECT}_STRUCTURE \
	(${C_TABLE_STRUCTURE_ATTRIBS},PARENT_ID,STRUCTURE_VERSION) \
VALUES \
	(${C_TABLE_STRUCTURE_VALUES},?,?)

	
C_RESOURCES_HISTORY_WRITE=\
INSERT INTO CMS_HISTORY_RESOURCES \
	(${C_TABLE_RESOURCES_ATTRIBS},\
	RESOURCE_VERSION,\
	PUBLISH_TAG) \
VALUES \
	(${C_TABLE_RESOURCES_VALUES},?,?)
	
	
C_STRUCTURE_HISTORY_WRITE=\
INSERT INTO CMS_HISTORY_STRUCTURE \
	(${C_TABLE_STRUCTURE_ATTRIBS},\
	STRUCTURE_VERSION,\
	PARENT_ID,\
	PUBLISH_TAG,\
	VERSION) \
VALUES \
	(${C_TABLE_STRUCTURE_VALUES},?,?,?,?)


C_RESOURCES_WRITE_PUBLISH_HISTORY=\
INSERT INTO CMS_PUBLISH_HISTORY \
	(PUBLISH_TAG,\
	STRUCTURE_ID,\
	RESOURCE_ID,\
	RESOURCE_PATH,\
	RESOURCE_STATE,\
	RESOURCE_TYPE,\
	HISTORY_ID,\
	SIBLING_COUNT) \
VALUES \
	(?,?,?,?,?,?,?,?)
	
	
C_RESOURCES_UPDATE_RESOURCES=\
UPDATE \
	CMS_${PROJECT}_RESOURCES \
SET \
	RESOURCE_TYPE=?,\
	RESOURCE_FLAGS=?,\
	DATE_LASTMODIFIED=?,\
	USER_LASTMODIFIED=?,\
	RESOURCE_STATE=?,\
	RESOURCE_SIZE=?,\
	DATE_CONTENT=?,\
	PROJECT_LASTMODIFIED=?,\
	SIBLING_COUNT=? \
WHERE \
	RESOURCE_ID=?
	
C_RESOURCES_UPDATE_RESOURCES_WITHOUT_STATE=\
UPDATE \
	CMS_${PROJECT}_RESOURCES \
SET \
	RESOURCE_TYPE=?,\
	RESOURCE_FLAGS=?,\
	DATE_LASTMODIFIED=?,\
	USER_LASTMODIFIED=?,\
	RESOURCE_SIZE=?,\
	DATE_CONTENT=?,\
	PROJECT_LASTMODIFIED=?,\
	SIBLING_COUNT=? \
WHERE \
	RESOURCE_ID=?
	
C_RESOURCES_TRANSFER_RESOURCE=\
UPDATE \
	CMS_${PROJECT}_RESOURCES \
SET \
	CMS_${PROJECT}_RESOURCES.USER_CREATED=?,\
	CMS_${PROJECT}_RESOURCES.USER_LASTMODIFIED=? \
WHERE \
	CMS_${PROJECT}_RESOURCES.RESOURCE_ID=?	
	
C_RESOURCES_UPDATE_STRUCTURE=\
UPDATE \
	CMS_${PROJECT}_STRUCTURE \
SET \
	RESOURCE_ID=?,\
	RESOURCE_PATH=?,\
	STRUCTURE_STATE=?, \
	DATE_RELEASED=?, \
	DATE_EXPIRED=?, \
	PARENT_ID=? \
WHERE \
	STRUCTURE_ID=?
	
	
#########
# The first part of the query collects all complete versions
# The second part collects all versions available before the sibling was created
#########
C_RESOURCES_HISTORY_READ_ALL_VERSIONS=\
(SELECT DISTINCT \
	${C_RESOURCES_SELECT_ATTRIBS_HISTORY},\
	CMS_HISTORY_RESOURCES.PROJECT_LASTMODIFIED LOCKED_IN_PROJECT \
FROM \
	${C_RESOURCES_SELECT_TABLES_HISTORY} \
WHERE \
	CMS_HISTORY_STRUCTURE.STRUCTURE_ID=? \
	AND ${C_JOIN_STRUCTURE_RESOURCE_HISTORY}) \
UNION \
(SELECT DISTINCT \
	CMS_HISTORY_RESOURCES.PUBLISH_TAG, \
	CMS_HISTORY_RESOURCES.RESOURCE_VERSION VERSION,\
	CMS_HISTORY_STRUCTURE.STRUCTURE_ID,\
	CMS_HISTORY_STRUCTURE.RESOURCE_PATH,\
	CMS_HISTORY_STRUCTURE.STRUCTURE_STATE,\
	CMS_HISTORY_STRUCTURE.DATE_RELEASED,\
	CMS_HISTORY_STRUCTURE.DATE_EXPIRED,\
	CMS_HISTORY_STRUCTURE.PARENT_ID,\
	CMS_HISTORY_RESOURCES.RESOURCE_ID,\
	CMS_HISTORY_RESOURCES.RESOURCE_TYPE,\
	CMS_HISTORY_RESOURCES.RESOURCE_FLAGS,\
	CMS_HISTORY_RESOURCES.RESOURCE_STATE,\
	CMS_HISTORY_RESOURCES.DATE_CREATED,\
	CMS_HISTORY_RESOURCES.DATE_LASTMODIFIED,\
	CMS_HISTORY_RESOURCES.USER_CREATED,\
	CMS_HISTORY_RESOURCES.USER_LASTMODIFIED,\
	CMS_HISTORY_RESOURCES.PROJECT_LASTMODIFIED,\
	CMS_HISTORY_RESOURCES.RESOURCE_SIZE,\
	CMS_HISTORY_RESOURCES.DATE_CONTENT,\
	CMS_HISTORY_RESOURCES.SIBLING_COUNT,\
	CMS_HISTORY_RESOURCES.PROJECT_LASTMODIFIED LOCKED_IN_PROJECT \
FROM \
	${C_RESOURCES_SELECT_TABLES_HISTORY} \
WHERE \
	CMS_HISTORY_STRUCTURE.STRUCTURE_ID=? \
	AND CMS_HISTORY_STRUCTURE.PUBLISH_TAG=? \
	AND CMS_HISTORY_STRUCTURE.RESOURCE_ID=CMS_HISTORY_RESOURCES.RESOURCE_ID \
	AND CMS_HISTORY_RESOURCES.PUBLISH_TAG<CMS_HISTORY_STRUCTURE.PUBLISH_TAG) \
ORDER BY \
	VERSION DESC


C_STRUCTURE_HISTORY_READ_MIN_PUBLISH_TAG=\
SELECT \
   MIN(PUBLISH_TAG) \
FROM \
   CMS_HISTORY_STRUCTURE \
WHERE \
   STRUCTURE_ID=?


C_RESOURCES_HISTORY_READ_DELETED=\
SELECT \
	${C_RESOURCES_SELECT_ATTRIBS_HISTORY},\
	CMS_HISTORY_RESOURCES.PROJECT_LASTMODIFIED LOCKED_IN_PROJECT \
FROM \
	${C_RESOURCES_SELECT_TABLES_HISTORY} \
WHERE \
    CMS_HISTORY_STRUCTURE.PARENT_ID=? AND \
    (CMS_HISTORY_STRUCTURE.STRUCTURE_STATE=3 OR CMS_HISTORY_RESOURCES.RESOURCE_STATE=3) AND \
	${C_JOIN_STRUCTURE_RESOURCE_HISTORY} \
ORDER BY \
	VERSION DESC
	
C_RESOURCES_HISTORY_READ_DELETED_RESTRICTED=\
SELECT \
	${C_RESOURCES_SELECT_ATTRIBS_HISTORY},\
	CMS_HISTORY_RESOURCES.PROJECT_LASTMODIFIED LOCKED_IN_PROJECT \
FROM \
	${C_RESOURCES_SELECT_TABLES_HISTORY} \
WHERE \
    CMS_HISTORY_STRUCTURE.PARENT_ID=? AND \
    CMS_HISTORY_RESOURCES.USER_LASTMODIFIED=? AND \
    (CMS_HISTORY_STRUCTURE.STRUCTURE_STATE=3 OR CMS_HISTORY_RESOURCES.RESOURCE_STATE=3) AND \
	${C_JOIN_STRUCTURE_RESOURCE_HISTORY} \
ORDER BY \
	VERSION DESC

	
C_RESOURCES_READ_MAX_PUBLISH_TAG=\
SELECT \
	MAX(PUBLISH_TAG) \
FROM \
	CMS_HISTORY_RESOURCES \
WHERE \
	CMS_HISTORY_RESOURCES.RESOURCE_ID=?
	
	
C_RESOURCES_READ=\
SELECT \
	${C_RESOURCES_SELECT_ATTRIBS},\
	CMS_${PROJECT}_RESOURCES.PROJECT_LASTMODIFIED \
FROM \
	${C_RESOURCES_SELECT_TABLES} \
WHERE \
	CMS_${PROJECT}_STRUCTURE.RESOURCE_PATH=? \
	AND ${C_JOIN_STRUCTURE_RESOURCE} \
ORDER BY \
	CMS_${PROJECT}_STRUCTURE.STRUCTURE_STATE ASC
	
C_RESOURCES_READ_PARENT_BY_ID=\
SELECT \
	${C_RESOURCES_SELECT_ATTRIBS},\
	CMS_${PROJECT}_RESOURCES.PROJECT_LASTMODIFIED \
FROM \
	${C_RESOURCES_SELECT_TABLES}, \
	CMS_${PROJECT}_STRUCTURE STR2 \
WHERE \
    STR2.STRUCTURE_ID=? \
	AND CMS_${PROJECT}_STRUCTURE.STRUCTURE_ID=STR2.PARENT_ID \
	AND ${C_JOIN_STRUCTURE_RESOURCE}

C_RESOURCES_READBYID=\
SELECT \
	${C_RESOURCES_SELECT_ATTRIBS},\
	CMS_${PROJECT}_RESOURCES.PROJECT_LASTMODIFIED \
FROM \
	${C_RESOURCES_SELECT_TABLES} \
WHERE \
	CMS_${PROJECT}_STRUCTURE.STRUCTURE_ID=? \
	AND ${C_JOIN_STRUCTURE_RESOURCE}

C_RESOURCES_SELECT_STRUCTURE_ID=\
SELECT \
	COUNT(CMS_${PROJECT}_STRUCTURE.STRUCTURE_ID) \
FROM \
	CMS_${PROJECT}_STRUCTURE \
WHERE \
	CMS_${PROJECT}_STRUCTURE.STRUCTURE_ID=?	
		
		
C_RESOURCES_GET_SUBRESOURCES=\
SELECT \
	${C_RESOURCES_SELECT_ATTRIBS} \
FROM \
	${C_RESOURCES_SELECT_TABLES} \
WHERE \
	CMS_${PROJECT}_STRUCTURE.PARENT_ID=? \
	AND ${C_JOIN_STRUCTURE_RESOURCE}
	
	
C_RESOURCES_GET_SUBRESOURCES_GET_FOLDERS=AND CMS_${PROJECT}_RESOURCES.RESOURCE_SIZE < 0
C_RESOURCES_GET_SUBRESOURCES_GET_FILES=AND CMS_${PROJECT}_RESOURCES.RESOURCE_SIZE >= 0

C_RESOURCES_READ_PARENT_STRUCTURE_ID=\
SELECT \
	CMS_${PROJECT}_STRUCTURE.STRUCTURE_ID \
FROM \
	CMS_${PROJECT}_STRUCTURE \
WHERE \
	CMS_${PROJECT}_STRUCTURE.RESOURCE_PATH=?	
		
		
C_RESOURCES_GET_RESOURCE_WITH_PROPERTYDEF=\
(SELECT DISTINCT \
	${C_RESOURCES_SELECT_ATTRIBS},\
	CMS_${PROJECT}_RESOURCES.PROJECT_LASTMODIFIED \
FROM \
	CMS_${PROJECT}_PROPERTIES, \
	CMS_${PROJECT}_RESOURCES, \
	CMS_${PROJECT}_STRUCTURE \
WHERE \
	CMS_${PROJECT}_PROPERTIES.PROPERTYDEF_ID = ? \
	AND CMS_${PROJECT}_PROPERTIES.PROPERTY_MAPPING_ID = CMS_${PROJECT}_RESOURCES.RESOURCE_ID \
	AND CMS_${PROJECT}_STRUCTURE.RESOURCE_ID = CMS_${PROJECT}_RESOURCES.RESOURCE_ID \
	AND CMS_${PROJECT}_STRUCTURE.RESOURCE_PATH LIKE ?) \
UNION \
(SELECT DISTINCT \
	${C_RESOURCES_SELECT_ATTRIBS},\
	CMS_${PROJECT}_RESOURCES.PROJECT_LASTMODIFIED \
FROM \
	CMS_${PROJECT}_PROPERTIES, \
	CMS_${PROJECT}_STRUCTURE, \
	CMS_${PROJECT}_RESOURCES \
WHERE \
	CMS_${PROJECT}_PROPERTIES.PROPERTYDEF_ID = ? \
	AND CMS_${PROJECT}_PROPERTIES.PROPERTY_MAPPING_ID = CMS_${PROJECT}_STRUCTURE.STRUCTURE_ID \
	AND CMS_${PROJECT}_STRUCTURE.RESOURCE_ID = CMS_${PROJECT}_RESOURCES.RESOURCE_ID \
	AND CMS_${PROJECT}_STRUCTURE.RESOURCE_PATH LIKE ?) \
ORDER BY RESOURCE_PATH DESC

C_RESOURCES_GET_RESOURCE_WITH_PROPERTYDEF_VALUE=\
(SELECT DISTINCT \
	${C_RESOURCES_SELECT_ATTRIBS},\
	CMS_${PROJECT}_RESOURCES.PROJECT_LASTMODIFIED \
FROM \
	CMS_${PROJECT}_PROPERTIES, \
	CMS_${PROJECT}_RESOURCES, \
	CMS_${PROJECT}_STRUCTURE \
WHERE \
	CMS_${PROJECT}_PROPERTIES.PROPERTYDEF_ID=? \
	AND CMS_${PROJECT}_PROPERTIES.PROPERTY_MAPPING_ID = CMS_${PROJECT}_RESOURCES.RESOURCE_ID \
	AND CMS_${PROJECT}_STRUCTURE.RESOURCE_ID = CMS_${PROJECT}_RESOURCES.RESOURCE_ID \
	AND CMS_${PROJECT}_STRUCTURE.RESOURCE_PATH LIKE ? \
	AND CMS_${PROJECT}_PROPERTIES.PROPERTY_VALUE LIKE ?) \
UNION \
(SELECT DISTINCT \
	${C_RESOURCES_SELECT_ATTRIBS},\
	CMS_${PROJECT}_RESOURCES.PROJECT_LASTMODIFIED \
FROM \
	CMS_${PROJECT}_PROPERTIES, \
	CMS_${PROJECT}_STRUCTURE, \
	CMS_${PROJECT}_RESOURCES \
WHERE \
	CMS_${PROJECT}_PROPERTIES.PROPERTYDEF_ID = ? \
	AND CMS_${PROJECT}_PROPERTIES.PROPERTY_MAPPING_ID = CMS_${PROJECT}_STRUCTURE.STRUCTURE_ID \
	AND CMS_${PROJECT}_STRUCTURE.RESOURCE_ID = CMS_${PROJECT}_RESOURCES.RESOURCE_ID \
	AND CMS_${PROJECT}_STRUCTURE.RESOURCE_PATH LIKE ? \
	AND CMS_${PROJECT}_PROPERTIES.PROPERTY_VALUE LIKE ?) \
ORDER BY RESOURCE_PATH DESC

C_RESOURCES_GET_RESOURCE_IN_PROJECT_WITH_STATE=\
SELECT DISTINCT \
	${C_RESOURCES_SELECT_ATTRIBS},\
	CMS_${PROJECT}_RESOURCES.PROJECT_LASTMODIFIED \
FROM \
	${C_RESOURCES_SELECT_TABLES} \
WHERE (\
	CMS_${PROJECT}_STRUCTURE.RESOURCE_ID=CMS_${PROJECT}_RESOURCES.RESOURCE_ID) \
	AND CMS_${PROJECT}_RESOURCES.PROJECT_LASTMODIFIED = ? \
	AND \
	(\
		(\
			CMS_${PROJECT}_RESOURCES.RESOURCE_STATE=? \
			AND CMS_${PROJECT}_STRUCTURE.STRUCTURE_STATE<=?\
		)\
		OR \
		(\
			CMS_${PROJECT}_STRUCTURE.STRUCTURE_STATE=? \
			AND CMS_${PROJECT}_RESOURCES.RESOURCE_STATE<=?\
		)\
	) \
ORDER BY \
	CMS_${PROJECT}_STRUCTURE.RESOURCE_PATH ASC


C_RESOURCES_GET_RESOURCE_IN_PROJECT_WITHOUT_STATE=\
SELECT DISTINCT \
	${C_RESOURCES_SELECT_ATTRIBS},\
	CMS_${PROJECT}_RESOURCES.PROJECT_LASTMODIFIED \
FROM \
	${C_RESOURCES_SELECT_TABLES} \
WHERE \
	CMS_${PROJECT}_STRUCTURE.RESOURCE_ID=CMS_${PROJECT}_RESOURCES.RESOURCE_ID \
	AND CMS_${PROJECT}_RESOURCES.PROJECT_LASTMODIFIED = ? \
	AND \
	(\
		CMS_${PROJECT}_RESOURCES.RESOURCE_STATE<>? \
		OR CMS_${PROJECT}_STRUCTURE.STRUCTURE_STATE<>? \
	)\
ORDER BY \
	CMS_${PROJECT}_STRUCTURE.RESOURCE_PATH ASC	
	
	
C_RESOURCES_GET_RESOURCE_IN_PROJECT_IGNORE_STATE=\
SELECT DISTINCT \
	${C_RESOURCES_SELECT_ATTRIBS},\
	CMS_${PROJECT}_RESOURCES.PROJECT_LASTMODIFIED \
FROM \
	${C_RESOURCES_SELECT_TABLES} \
WHERE \
	CMS_${PROJECT}_STRUCTURE.RESOURCE_ID=CMS_${PROJECT}_RESOURCES.RESOURCE_ID \
	AND CMS_${PROJECT}_RESOURCES.PROJECT_LASTMODIFIED = ? \
ORDER BY \
	CMS_${PROJECT}_STRUCTURE.RESOURCE_PATH ASC	
		
		
C_RESOURCE_REPLACE=\
UPDATE \
	CMS_${PROJECT}_RESOURCES \
SET \
	RESOURCE_TYPE=?,\
	RESOURCE_SIZE=? \
WHERE \
	RESOURCE_ID=?


C_RESOURCES_UPDATE_SIBLING_COUNT=\
UPDATE \
	CMS_${PROJECT}_RESOURCES \
SET \
	SIBLING_COUNT=? \
WHERE \
	RESOURCE_ID=?
	
	
C_RESOURCES_MOVE=\
UPDATE \
	CMS_${PROJECT}_STRUCTURE \
SET \
	RESOURCE_PATH=?, \
	PARENT_ID=? \
WHERE \
	STRUCTURE_ID=?
	
	
C_RESOURCES_UPDATE_FLAGS=\
UPDATE \
	CMS_${PROJECT}_RESOURCES \
SET \
	RESOURCE_FLAGS=? \
WHERE \
	RESOURCE_ID=?
	
	
C_RESOURCES_UPDATE_RESOURCE_STATE=\
UPDATE \
	CMS_${PROJECT}_RESOURCES \
SET \
	RESOURCE_STATE=?, \
    PROJECT_LASTMODIFIED=? \
WHERE \
	RESOURCE_ID=?
	
	
C_RESOURCES_UPDATE_RESOURCE_PROJECT=\
UPDATE \
	CMS_${PROJECT}_RESOURCES \
SET \
	RESOURCE_FLAGS=?, \
    PROJECT_LASTMODIFIED=? \
WHERE \
	RESOURCE_ID=?

 	
C_RESOURCES_UPDATE_RESOURCE_STATELASTMODIFIED=\
UPDATE \
	CMS_${PROJECT}_RESOURCES \
SET \
	RESOURCE_STATE=?, \
    DATE_LASTMODIFIED=?, \
    USER_LASTMODIFIED=?, \
    PROJECT_LASTMODIFIED=? \
WHERE \
	RESOURCE_ID=?	


C_RESOURCES_UPDATE_STRUCTURE_STATE=\
UPDATE \
	CMS_${PROJECT}_STRUCTURE \
SET \
	STRUCTURE_STATE=? \
WHERE \
	STRUCTURE_ID=?
	
	
C_RESOURCES_UPDATE_RELEASE_EXPIRED=\
UPDATE \
	CMS_${PROJECT}_STRUCTURE \
SET \
	DATE_RELEASED=?, \
    DATE_EXPIRED=? \
WHERE \
	STRUCTURE_ID=?	
	

C_RESOURCES_READ_RESOURCE_STATE=\
SELECT \
	CMS_${PROJECT}_RESOURCES.RESOURCE_STATE \
FROM \
	CMS_${PROJECT}_RESOURCES \
WHERE \
	CMS_${PROJECT}_RESOURCES.RESOURCE_ID=?
		
	
C_RESOURCES_COUNT_SIBLINGS=\
SELECT \
	COUNT(CMS_${PROJECT}_STRUCTURE.STRUCTURE_ID) \
FROM \
	CMS_${PROJECT}_STRUCTURE \
WHERE \
	CMS_${PROJECT}_STRUCTURE.RESOURCE_ID=?

	
C_RESOURCES_DELETE_BY_RESOURCEID=\
DELETE FROM \
	CMS_${PROJECT}_RESOURCES \
WHERE \
	RESOURCE_ID=?
	
		
C_STRUCTURE_DELETE_BY_STRUCTUREID=\
DELETE FROM \
	CMS_${PROJECT}_STRUCTURE \
WHERE \
	STRUCTURE_ID=?


C_RESOURCES_UPDATE_PROJECT_LASTMODIFIED=\
UPDATE \
	CMS_${PROJECT}_RESOURCES \
SET \
	PROJECT_LASTMODIFIED=? \
WHERE \
	RESOURCE_ID=?	


C_PROJECTS_HISTORY_MAXTAG=\
SELECT \
	MAX(PUBLISH_TAG) \
FROM \
	CMS_HISTORY_PROJECTS


C_RESOURCES_HISTORY_MAXTAG=\
SELECT \
	MAX(PUBLISH_TAG) \
FROM \
	CMS_HISTORY_STRUCTURE


C_STRUCTURE_HISTORY_MAXVER=\
SELECT \
	MAX(VERSION) \
FROM \
	CMS_HISTORY_STRUCTURE \
WHERE \
	CMS_HISTORY_STRUCTURE.STRUCTURE_ID=?

#
# General subtree selection statement
#
C_RESOURCES_READ_TREE=\
SELECT ${C_RESOURCES_SELECT_ATTRIBS},CMS_${PROJECT}_RESOURCES.PROJECT_LASTMODIFIED \
FROM ${C_RESOURCES_SELECT_TABLES} \
WHERE ${C_JOIN_RESOURCE_STRUCTURE}

#
# Selection criteria
#
C_RESOURCES_SELECT_BY_PROJECT_LASTMODIFIED=\
	CMS_${PROJECT}_RESOURCES.PROJECT_LASTMODIFIED=?
C_RESOURCES_SELECT_BY_PATH_PREFIX=\
	CMS_${PROJECT}_STRUCTURE.RESOURCE_PATH LIKE ? ESCAPE '|'
C_RESOURCES_SELECT_BY_PARENT_UUID=\
	CMS_${PROJECT}_STRUCTURE.PARENT_ID = ?	
C_RESOURCES_SELECT_BY_RESOURCE_TYPE=\
	CMS_${PROJECT}_RESOURCES.RESOURCE_TYPE=?
C_RESOURCES_SELECT_BY_RESOURCE_STATE=\
	((CMS_${PROJECT}_STRUCTURE.STRUCTURE_STATE=? AND CMS_${PROJECT}_STRUCTURE.STRUCTURE_STATE >= CMS_${PROJECT}_RESOURCES.RESOURCE_STATE) OR \
	(CMS_${PROJECT}_RESOURCES.RESOURCE_STATE=? AND CMS_${PROJECT}_RESOURCES.RESOURCE_STATE >= CMS_${PROJECT}_STRUCTURE.STRUCTURE_STATE))
C_RESOURCES_SELECT_BY_DATE_LASTMODIFIED_AFTER=\
	CMS_${PROJECT}_RESOURCES.DATE_LASTMODIFIED >= ?
C_RESOURCES_SELECT_BY_DATE_LASTMODIFIED_BEFORE=\
	CMS_${PROJECT}_RESOURCES.DATE_LASTMODIFIED <= ?
C_STRUCTURE_SELECT_BY_DATE_EXPIRED_AFTER=\
	(CMS_${PROJECT}_STRUCTURE.DATE_EXPIRED != 0) AND (CMS_${PROJECT}_STRUCTURE.DATE_EXPIRED >= ?)
C_STRUCTURE_SELECT_BY_DATE_EXPIRED_BEFORE=\
	(CMS_${PROJECT}_STRUCTURE.DATE_EXPIRED != 0) AND (CMS_${PROJECT}_STRUCTURE.DATE_EXPIRED <= ?)
C_STRUCTURE_SELECT_BY_DATE_RELEASED_AFTER=\
	(CMS_${PROJECT}_STRUCTURE.DATE_RELEASED != 0) AND (CMS_${PROJECT}_STRUCTURE.DATE_RELEASED >= ?)
C_STRUCTURE_SELECT_BY_DATE_RELEASED_BEFORE=\
	(CMS_${PROJECT}_STRUCTURE.DATE_RELEASED != 0) AND (CMS_${PROJECT}_STRUCTURE.DATE_RELEASED <= ?)
C_RESOURCES_SELECT_ONLY_FOLDERS=\
	CMS_${PROJECT}_RESOURCES.RESOURCE_SIZE = -1
C_RESOURCES_SELECT_ONLY_FILES=\
	CMS_${PROJECT}_RESOURCES.RESOURCE_SIZE > -1
#
# Resources order
#
C_RESOURCES_ORDER_BY_PATH=\
	ORDER BY CMS_${PROJECT}_STRUCTURE.RESOURCE_PATH

#
# Files
#

C_FILE_CONTENT=FILE_CONTENT


C_OFFLINE_CONTENTS_WRITE=\
INSERT INTO CMS_OFFLINE_CONTENTS (\
	RESOURCE_ID,\
	FILE_CONTENT) \
VALUES \
	(?,?)


C_ONLINE_CONTENTS_WRITE=\
INSERT INTO CMS_CONTENTS (\
	RESOURCE_ID,\
	FILE_CONTENT,\
	PUBLISH_TAG_FROM,\
	PUBLISH_TAG_TO,\
	ONLINE_FLAG) \
VALUES \
	(?,?,99999999,99999999,1)
	
C_ONLINE_CONTENTS_HISTORY=\
UPDATE \
	CMS_CONTENTS \
SET \
	ONLINE_FLAG = 0 \
WHERE \
	RESOURCE_ID = ? \
	AND ONLINE_FLAG = 1

	
C_HISTORY_CONTENTS_CREATE=\
UPDATE \
	CMS_CONTENTS \
SET \
	PUBLISH_TAG_FROM = ?, \
	PUBLISH_TAG_TO = ? \
WHERE \
	RESOURCE_ID = ? \
	AND PUBLISH_TAG_FROM = 99999999 \
	AND PUBLISH_TAG_TO = 99999999


C_HISTORY_CONTENTS_UPDATE=\
UPDATE \
	CMS_CONTENTS \
SET \
	PUBLISH_TAG_TO = ? \
WHERE \
	RESOURCE_ID = ? \
	AND PUBLISH_TAG_TO = ?


C_OFFLINE_CONTENTS_UPDATE=\
UPDATE \
	CMS_OFFLINE_CONTENTS \
SET \
	FILE_CONTENT=? \
WHERE \
	RESOURCE_ID=?


C_OFFLINE_FILES_CONTENT=\
SELECT \
	FILE_CONTENT \
FROM \
	CMS_OFFLINE_CONTENTS \
WHERE \
	RESOURCE_ID=?
	
	
C_ONLINE_FILES_CONTENT=\
SELECT \
	CMS_CONTENTS.FILE_CONTENT \
FROM \
	CMS_CONTENTS,\
	CMS_ONLINE_RESOURCES \
WHERE \
	CMS_ONLINE_RESOURCES.RESOURCE_ID=? \
	AND ${C_JOIN_RESOURCE_ONLINE_FILE}
	
	
C_RESOURCES_HISTORY_READ_VERSION=\
SELECT \
	${C_RESOURCES_SELECT_ATTRIBS_HISTORY},\
	CMS_HISTORY_RESOURCES.PROJECT_LASTMODIFIED LOCKED_IN_PROJECT \
FROM \
	${C_RESOURCES_SELECT_TABLES_HISTORY} \
WHERE \
	CMS_HISTORY_STRUCTURE.STRUCTURE_ID=? \
	AND CMS_HISTORY_STRUCTURE.VERSION=? \
	AND ${C_JOIN_STRUCTURE_RESOURCE_HISTORY}
	
C_HISTORY_READ_CONTENT=\
SELECT \
	CMS_CONTENTS.FILE_CONTENT \
FROM \
	${C_RESOURCES_SELECT_TABLES_HISTORY},\
	CMS_CONTENTS \
WHERE \
	CMS_HISTORY_STRUCTURE.STRUCTURE_ID=? \
	AND CMS_HISTORY_STRUCTURE.VERSION=? \
	AND ${C_JOIN_STRUCTURE_RESOURCE_HISTORY} \
	AND ${C_JOIN_RESOURCE_FILE_HISTORY}
	
############
# This query is just used by deprecated methods
# remove it as soon as possible
# see org.opencms.db.I_CmsHistoryDriver#readFile(CmsDbContext, CmsUUID, int)
############	
C_FILES_READ_HISTORY_BYID=\
SELECT \
	${C_RESOURCES_SELECT_ATTRIBS_HISTORY},\
	CMS_CONTENTS.FILE_CONTENT,\
	CMS_HISTORY_RESOURCES.PROJECT_LASTMODIFIED LOCKED_IN_PROJECT \
FROM \
	${C_RESOURCES_SELECT_TABLES_HISTORY},\
	CMS_CONTENTS \
WHERE \
	CMS_HISTORY_STRUCTURE.STRUCTURE_ID=? \
	AND CMS_HISTORY_STRUCTURE.PUBLISH_TAG=? \
	AND ${C_JOIN_STRUCTURE_RESOURCE_HISTORY} \
	AND ${C_JOIN_RESOURCE_FILE_HISTORY}


C_OFFLINE_FILE_CONTENT_DELETE=\
DELETE FROM \
	CMS_OFFLINE_CONTENTS \
WHERE \
	RESOURCE_ID=?


#
# Propertydefinitions
#
C_PROPERTYDEF_ID=PROPERTYDEF_ID
C_PROPERTYDEF_NAME=PROPERTYDEF_NAME
C_PROPERTYDEF_TYPE=PROPERTYDEF_TYPE


C_PROPERTYDEF_READ=\
SELECT \
	* \
FROM \
	CMS_${PROJECT}_PROPERTYDEF \
WHERE \
	PROPERTYDEF_NAME=?	
	
C_PROPERTYDEF_READ_HISTORY=\
SELECT \
	* \
FROM \
	CMS_HISTORY_PROPERTYDEF \
WHERE \
	PROPERTYDEF_NAME=?
	
C_PROPERTYDEF_READALL=\
SELECT \
	* \
FROM \
	CMS_${PROJECT}_PROPERTYDEF	
	
C_PROPERTYDEF_CREATE=\
INSERT INTO CMS_${PROJECT}_PROPERTYDEF \
VALUES \
	(?,?,?)
	
	
C_PROPERTYDEF_CREATE_HISTORY=\
INSERT INTO CMS_HISTORY_PROPERTYDEF \
VALUES \
	(?,?,?)
	
	
C_PROPERTYDEF_DELETE=\
DELETE FROM \
	CMS_${PROJECT}_PROPERTYDEF \
WHERE \
	PROPERTYDEF_ID=?
	
	
C_PROPERTYDEF_DELETE_HISTORY=\
DELETE FROM \
	CMS_HISTORY_PROPERTYDEF \
WHERE \
	PROPERTYDEF_ID=?


#
# Properties
#
C_PROPERTY_VALUE=PROPERTY_VALUE
C_PROPERTY_RESOURCE_ID=RESOURCE_ID


C_PROPERTIES_READALL_COUNT=\
SELECT \
	COUNT(*) \
FROM \
	CMS_${PROJECT}_PROPERTIES \
WHERE \
	PROPERTYDEF_ID=?

	
C_PROPERTIES_UPDATE=\
UPDATE \
	CMS_${PROJECT}_PROPERTIES \
SET \
	PROPERTY_VALUE=? \
WHERE \
	PROPERTY_MAPPING_ID=? \
	AND PROPERTY_MAPPING_TYPE=? \
	AND PROPERTYDEF_ID=?

	
C_PROPERTIES_CREATE=\
INSERT INTO CMS_${PROJECT}_PROPERTIES \
	(PROPERTY_ID,\
	PROPERTYDEF_ID,\
	PROPERTY_MAPPING_ID,\
	PROPERTY_MAPPING_TYPE,\
	PROPERTY_VALUE) \
VALUES \
	(?,?,?,?,?)
	
	
C_PROPERTIES_HISTORY_CREATE=\
INSERT INTO CMS_HISTORY_PROPERTIES \
	(STRUCTURE_ID,\
	PROPERTYDEF_ID,\
	PROPERTY_MAPPING_ID,\
	PROPERTY_MAPPING_TYPE,\
	PROPERTY_VALUE,\
	PUBLISH_TAG) \
VALUES \
	(?,?,?,?,?,?)


C_PROPERTIES_READ=\
SELECT \
	CMS_${PROJECT}_PROPERTIES.PROPERTY_VALUE,\
	CMS_${PROJECT}_PROPERTIES.PROPERTY_MAPPING_TYPE \
FROM \
	CMS_${PROJECT}_PROPERTYDEF,\
	CMS_${PROJECT}_PROPERTIES \
WHERE \
	CMS_${PROJECT}_PROPERTYDEF.PROPERTYDEF_NAME=? \
    AND CMS_${PROJECT}_PROPERTIES.PROPERTYDEF_ID=CMS_${PROJECT}_PROPERTYDEF.PROPERTYDEF_ID \
	AND \
	(\
		CMS_${PROJECT}_PROPERTIES.PROPERTY_MAPPING_ID=? \
			OR \
		CMS_${PROJECT}_PROPERTIES.PROPERTY_MAPPING_ID=?\
	)
                     
                     
C_PROPERTIES_READALL=\
SELECT \
	CMS_${PROJECT}_PROPERTYDEF.PROPERTYDEF_NAME,\
	CMS_${PROJECT}_PROPERTIES.PROPERTY_VALUE,\
	CMS_${PROJECT}_PROPERTIES.PROPERTY_MAPPING_TYPE \
FROM \
	CMS_${PROJECT}_PROPERTYDEF,\
	CMS_${PROJECT}_PROPERTIES \
WHERE \
	(\
		CMS_${PROJECT}_PROPERTIES.PROPERTY_MAPPING_ID=? \
			OR \
		CMS_${PROJECT}_PROPERTIES.PROPERTY_MAPPING_ID=?\
	) \
	AND \
	(\
		CMS_${PROJECT}_PROPERTIES.PROPERTYDEF_ID=CMS_${PROJECT}_PROPERTYDEF.PROPERTYDEF_ID\
	)                     
                     
                     
C_PROPERTIES_HISTORY_READALL=\
SELECT \
	CMS_HISTORY_PROPERTYDEF.PROPERTYDEF_NAME, \
	CMS_HISTORY_PROPERTIES.PROPERTY_VALUE,\
	CMS_HISTORY_PROPERTIES.PROPERTY_MAPPING_TYPE \
FROM \
	CMS_HISTORY_PROPERTIES,\
	CMS_HISTORY_PROPERTYDEF \
WHERE \
	CMS_HISTORY_PROPERTIES.PROPERTYDEF_ID=CMS_HISTORY_PROPERTYDEF.PROPERTYDEF_ID \
	AND \
	(\
		CMS_HISTORY_PROPERTIES.PROPERTY_MAPPING_ID=? \
		OR CMS_HISTORY_PROPERTIES.PROPERTY_MAPPING_ID=?\
	) \
	AND CMS_HISTORY_PROPERTIES.PUBLISH_TAG=?
                            
	
C_PROPERTIES_DELETE_ALL_STRUCTURE_AND_RESOURCE_VALUES=\
DELETE FROM \
	CMS_${PROJECT}_PROPERTIES \
WHERE \
	(\
		PROPERTY_MAPPING_ID=? \
		AND PROPERTY_MAPPING_TYPE=?\
	) \
	OR \
	(\
		PROPERTY_MAPPING_ID=? \
		AND PROPERTY_MAPPING_TYPE=?\
	)
	
	
C_PROPERTIES_DELETE_ALL_VALUES_FOR_MAPPING_TYPE=\
DELETE FROM \
	CMS_${PROJECT}_PROPERTIES \
WHERE \
	PROPERTY_MAPPING_ID=? \
	AND PROPERTY_MAPPING_TYPE=?
	
	
C_PROPERTIES_DELETE=\
DELETE FROM \
	CMS_${PROJECT}_PROPERTIES \
WHERE \
	PROPERTYDEF_ID=?  \
	AND PROPERTY_MAPPING_ID=? \
	AND PROPERTY_MAPPING_TYPE=?
	

#
# Groups
#
C_GROUPS_GROUP_ID_0=GROUP_ID
C_GROUPS_PARENT_GROUP_ID_0=PARENT_GROUP_ID
C_GROUPS_GROUP_NAME_0=GROUP_NAME
C_GROUPS_GROUP_DESCRIPTION_0=GROUP_DESCRIPTION
C_GROUPS_GROUP_FLAGS_0=GROUP_FLAGS
C_GROUPS_GROUP_OU_0=GROUP_OU

C_GROUPS_READ_BY_NAME_2=\
SELECT \
	* \
FROM \
	CMS_GROUPS \
WHERE \
	GROUP_NAME=? AND \
	GROUP_OU=?
	
	
C_GROUPS_READ_BY_ID_1=\
SELECT \
	* \
FROM \
	CMS_GROUPS \
WHERE \
	GROUP_ID=?
	
	
C_GROUPS_CREATE_GROUP_6=\
INSERT INTO CMS_GROUPS \
VALUES \
	(?,?,?,?,?,?)
	
	
C_GROUPS_WRITE_GROUP_4=\
UPDATE \
	CMS_GROUPS \
SET \
	GROUP_DESCRIPTION=?,\
	GROUP_FLAGS=?,\
	PARENT_GROUP_ID=? \
WHERE \
	GROUP_ID=?
	
	
C_GROUPS_DELETE_GROUP_2=\
DELETE FROM \
	CMS_GROUPS \
WHERE \
	GROUP_NAME=? AND \
	GROUP_OU=?
	
	
C_GROUPS_GROUP_OU_EQUALS_1	=GROUP_OU = ?
C_GROUPS_GROUP_OU_LIKE_1	=GROUP_OU LIKE ?
C_GROUPS_SELECT_GROUPS_1	=GROUP_FLAGS < ?
C_GROUPS_SELECT_ROLES_1		=GROUP_FLAGS >= ?
C_GROUPS_ORDER_0			=ORDER BY GROUP_OU, GROUP_NAME

C_GROUPS_GET_GROUPS_0=\
SELECT \
	* \
FROM \
	CMS_GROUPS \
WHERE 
	
	
C_GROUPS_GET_CHILD_1=\
SELECT \
	* \
FROM \
	CMS_GROUPS \
WHERE \
	PARENT_GROUP_ID=?
	
	
C_GROUPS_GET_GROUPS_OF_USER_1=\
SELECT \
	* \
FROM \
	CMS_GROUPS G,\
	CMS_GROUPUSERS GU \
WHERE \
	GU.USER_ID=? \
    AND G.GROUP_ID=GU.GROUP_ID \
    AND
	

	
C_GROUPS_ADD_USER_TO_GROUP_3=\
INSERT INTO CMS_GROUPUSERS \
	(GROUP_ID,\
	USER_ID,\
	GROUPUSER_FLAGS) \
VALUES \
	(?,?,?)
	
	
C_GROUPS_USER_IN_GROUP_2=\
SELECT \
	* \
FROM \
	CMS_GROUPUSERS \
WHERE \
	GROUP_ID=? \
	AND USER_ID=?
	
	
C_GROUPS_GET_USERS_OF_GROUP_2=\
SELECT \
	U.USER_ID,\
	U.USER_NAME,\
	U.USER_PASSWORD,\
	U.USER_FIRSTNAME,\
	U.USER_LASTNAME,\
	U.USER_EMAIL,\
	U.USER_LASTLOGIN,\
	U.USER_FLAGS,\
	U.USER_OU,\
	U.USER_DATECREATED \
FROM \
	CMS_GROUPS G, \
	CMS_USERS U, \
	CMS_GROUPUSERS GU \
WHERE \
	G.GROUP_NAME=? \
	AND G.GROUP_OU=? \
	AND G.GROUP_OU=U.USER_OU \
    AND U.USER_ID=GU.USER_ID \
    AND GU.GROUP_ID=G.GROUP_ID \
ORDER BY \
	USER_OU,USER_NAME

	
C_GROUPS_GET_ALL_USERS_OF_GROUP_2=\
SELECT \
	U.USER_ID,\
	U.USER_NAME,\
	U.USER_PASSWORD,\
	U.USER_FIRSTNAME,\
	U.USER_LASTNAME,\
	U.USER_EMAIL,\
	U.USER_LASTLOGIN,\
	U.USER_FLAGS,\
	U.USER_OU,\
	U.USER_DATECREATED \
FROM \
	CMS_GROUPS G, \
	CMS_USERS U, \
	CMS_GROUPUSERS GU \
WHERE \
	G.GROUP_NAME=? \
	AND G.GROUP_OU=? \
    AND U.USER_ID=GU.USER_ID \
    AND GU.GROUP_ID=G.GROUP_ID \
ORDER BY \
	USER_OU,USER_NAME

	
C_GROUPS_REMOVE_USER_FROM_GROUP_2=\
DELETE FROM \
	CMS_GROUPUSERS \
WHERE \
	GROUP_ID=? \
	AND USER_ID=?


#
# Users
#
C_USERS_USER_ID_0=USER_ID
C_USERS_USER_NAME_0=USER_NAME
C_USERS_USER_PASSWORD_0=USER_PASSWORD
C_USERS_USER_FIRSTNAME_0=USER_FIRSTNAME
C_USERS_USER_LASTNAME_0=USER_LASTNAME
C_USERS_USER_LASTLOGIN_0=USER_LASTLOGIN
C_USERS_USER_FLAGS_0=USER_FLAGS
C_USERS_USER_EMAIL_0=USER_EMAIL
C_USERS_USER_OU_0=USER_OU
C_USERS_USER_DATECREATED_0=USER_DATECREATED

C_USER_ATTRIBS=\
	USER_ID,\
	USER_NAME,\
	USER_PASSWORD,\
	USER_FIRSTNAME,\
	USER_LASTNAME,\
	USER_EMAIL,\
	USER_LASTLOGIN,\
	USER_FLAGS,\
	USER_OU,\
	USER_DATECREATED

C_USERS_ADD_10=\
INSERT INTO CMS_USERS \
	(${C_USER_ATTRIBS}) \
VALUES \
	(?,?,?,?,?,?,?,?,?,?)
	
	
C_USERS_READ_BY_NAME_2=\
SELECT \
	${C_USER_ATTRIBS} \
FROM \
	CMS_USERS \
WHERE \
	USER_NAME=? \
    AND USER_OU=?
	
	
C_USERS_READ_BY_ID_1=\
SELECT \
	${C_USER_ATTRIBS} \
FROM \
	CMS_USERS \
WHERE \
	USER_ID=?
	
	
C_USERS_READ_WITH_PWD_3=\
SELECT \
	${C_USER_ATTRIBS} \
FROM \
	CMS_USERS \
WHERE \
	USER_NAME=? \
	AND USER_OU=? \
    AND USER_PASSWORD=?
	
C_USERS_WRITE_6=\
UPDATE \
	CMS_USERS \
SET \
	USER_FIRSTNAME=?,\
	USER_LASTNAME=?,\
	USER_EMAIL=?,\
	USER_LASTLOGIN=?,\
	USER_FLAGS=? \
WHERE \
	USER_ID=?
	
	
C_USERS_DELETE_2=\
DELETE FROM \
	CMS_USERS \
WHERE \
	USER_NAME = ? AND \
	USER_OU = ?
	

C_USERS_GET_USERS_FOR_ORGUNIT_1=\
SELECT \
	${C_USER_ATTRIBS} \
FROM \
	CMS_USERS \
WHERE \
    USER_OU LIKE ? \
ORDER BY \
	USER_NAME
	
	
C_USERS_SET_PWD_3=\
UPDATE \
	CMS_USERS \
SET \
	USER_PASSWORD=? \
WHERE \
	USER_NAME=? AND \
	USER_OU=?
	

C_USERS_SET_ORGUNIT_2=\
UPDATE \
  CMS_USERS \
SET \
  USER_OU = ? \
WHERE \
  USER_ID = ?


#
# Userdata
#
C_USERDATA_USERID_0=USER_ID
C_USERDATA_KEY_0=DATA_KEY
C_USERDATA_VALUE_0=DATA_VALUE
C_USERDATA_TYPE_0=DATA_TYPE

C_USERDATA_ATTRIBS=\
	USER_ID,\
	DATA_KEY,\
	DATA_VALUE,\
	DATA_TYPE

C_USERDATA_WRITE_4=\
INSERT INTO	CMS_USERDATA \
	(${C_USERDATA_ATTRIBS}) \
VALUES \
    (?, ?, ?, ?)

C_USERDATA_DELETE_1=\
DELETE FROM CMS_USERDATA \
WHERE \
    USER_ID = ?
    
C_USERDATA_READ_1=\
SELECT \
	${C_USERDATA_ATTRIBS} \
FROM \
    CMS_USERDATA \
WHERE \
	USER_ID = ?

#
# User history
#
C_PRINCIPALS_HISTORY_ID=PRINCIPAL_ID
C_PRINCIPALS_HISTORY_NAME=PRINCIPAL_NAME
C_PRINCIPALS_HISTORY_DESCRIPTION=PRINCIPAL_DESCRIPTION
C_PRINCIPALS_HISTORY_EMAIL=PRINCIPAL_EMAIL
C_PRINCIPALS_HISTORY_OU=PRINCIPAL_OU
C_PRINCIPALS_HISTORY_TYPE=PRINCIPAL_TYPE
C_PRINCIPALS_HISTORY_USERDELETED=PRINCIPAL_USERDELETED
C_PRINCIPALS_HISTORY_DATEDELETED=PRINCIPAL_DATEDELETED

C_PRINCIPAL_HISTORY_ATTRIBS=\
	PRINCIPAL_ID,\
	PRINCIPAL_NAME,\
	PRINCIPAL_DESCRIPTION,\
	PRINCIPAL_OU,\
	PRINCIPAL_EMAIL,\
	PRINCIPAL_TYPE,\
	PRINCIPAL_USERDELETED,\
	PRINCIPAL_DATEDELETED

C_HISTORY_PRINCIPAL_CREATE=\
INSERT INTO CMS_HISTORY_PRINCIPALS \
	(${C_PRINCIPAL_HISTORY_ATTRIBS}) \
VALUES \
	(?,?,?,?,?,?,?,?)
	
C_HISTORY_PRINCIPAL_READ=\
SELECT \
	${C_PRINCIPAL_HISTORY_ATTRIBS} \
FROM \
	CMS_HISTORY_PRINCIPALS \
WHERE \
	PRINCIPAL_ID=?

C_PROJECTS_HISTORY_READ_TAG_FOR_DATE=\
SELECT \
	MAX(PUBLISH_TAG) \
FROM \
	CMS_HISTORY_PROJECTS \
WHERE \
	PROJECT_PUBLISHDATE<?

		
C_HISTORY_EXISTS_RESOURCE=\
SELECT \
	CMS_HISTORY_RESOURCES.RESOURCE_ID \
FROM \
	CMS_HISTORY_RESOURCES \
WHERE \
	CMS_HISTORY_RESOURCES.RESOURCE_ID=? \
	AND CMS_HISTORY_RESOURCES.PUBLISH_TAG=?

C_STRUCTURE_HISTORY_READALL=\
SELECT DISTINCT \
	STRUCTURE_ID, RESOURCE_ID \
FROM \
	CMS_HISTORY_STRUCTURE

C_STRUCTURE_HISTORY_READ_DELETED=\
SELECT DISTINCT \
	STRUCTURE_ID, RESOURCE_ID \
FROM \
	CMS_HISTORY_STRUCTURE \
WHERE \
    STRUCTURE_ID NOT IN (SELECT STRUCTURE_ID FROM CMS_ONLINE_STRUCTURE)

C_HISTORY_READ_MAXTAG_FOR_VERSION=\
SELECT \
	MAX(PUBLISH_TAG) \
FROM \
	CMS_HISTORY_STRUCTURE \
WHERE \
	STRUCTURE_ID=? \
	AND VERSION<?


C_PROPERTIES_HISTORY_DELETE=\
DELETE FROM \
	CMS_HISTORY_PROPERTIES \
WHERE \
	STRUCTURE_ID=? \
	AND PUBLISH_TAG<?


C_STRUCTURE_HISTORY_DELETE=\
DELETE FROM \
	CMS_HISTORY_STRUCTURE \
WHERE \
	STRUCTURE_ID=? \
	AND PUBLISH_TAG<?


C_HISTORY_READ_MIN_USED_TAG=\
SELECT \
	MIN(PUBLISH_TAG) \
FROM \
	CMS_HISTORY_STRUCTURE \
WHERE \
	RESOURCE_ID=?


C_RESOURCES_HISTORY_DELETE=\
DELETE FROM \
	CMS_HISTORY_RESOURCES \
WHERE \
	RESOURCE_ID=? \
	AND PUBLISH_TAG<?


C_CONTENT_HISTORY_DELETE=\
DELETE FROM \
	CMS_CONTENTS \
WHERE \
	ONLINE_FLAG = 0 \
	AND RESOURCE_ID=? \
	AND PUBLISH_TAG_TO<?


#
# Warning: Expects C_STATE_DELETED = 3 and all states >= 0 / <= 3
#
C_SELECT_NONDELETED_VFS_SIBLINGS=\
SELECT \
	${C_RESOURCES_SELECT_ATTRIBS},\
	CMS_${PROJECT}_RESOURCES.PROJECT_LASTMODIFIED \
FROM \
	${C_RESOURCES_SELECT_TABLES} \
WHERE \
	CMS_${PROJECT}_RESOURCES.RESOURCE_ID=? \
	AND CMS_${PROJECT}_STRUCTURE.STRUCTURE_STATE IN(0,1,2) \
	AND ${C_JOIN_STRUCTURE_RESOURCE} \
ORDER BY \
	CMS_${PROJECT}_STRUCTURE.RESOURCE_PATH ASC

	
C_SELECT_VFS_SIBLINGS=\
SELECT \
	${C_RESOURCES_SELECT_ATTRIBS},\
	CMS_${PROJECT}_RESOURCES.PROJECT_LASTMODIFIED \
FROM \
	${C_RESOURCES_SELECT_TABLES} \
WHERE \
	CMS_${PROJECT}_RESOURCES.RESOURCE_ID=? \
	AND ${C_JOIN_STRUCTURE_RESOURCE} \
ORDER BY \
	CMS_${PROJECT}_STRUCTURE.RESOURCE_PATH ASC	
			
#
#	Access Control Entries
#
C_ACCESS_RESOURCE_ID_0=RESOURCE_ID
C_ACCESS_PRINCIPAL_ID_0=PRINCIPAL_ID
C_ACCESS_ACCESS_ALLOWED_0=ACCESS_ALLOWED
C_ACCESS_ACCESS_DENIED_0=ACCESS_DENIED
C_ACCESS_ACCESS_FLAGS_0=ACCESS_FLAGS

C_ACCESS_CREATE_5=\
INSERT INTO CMS_${PROJECT}_ACCESSCONTROL \
	(RESOURCE_ID,\
	PRINCIPAL_ID,\
	ACCESS_ALLOWED,\
	ACCESS_DENIED,\
	ACCESS_FLAGS) \
VALUES \
	(?,?,?,?,?)
	
	
C_ACCESS_UPDATE_5=\
UPDATE \
	CMS_${PROJECT}_ACCESSCONTROL \
SET \
	ACCESS_ALLOWED=?,\
	ACCESS_DENIED=?,\
	ACCESS_FLAGS=? \
WHERE \
	RESOURCE_ID=? \
	AND PRINCIPAL_ID = ?
	
	
C_ACCESS_SET_FLAGS_ALL_2=\
UPDATE \
	CMS_${PROJECT}_ACCESSCONTROL \
SET \
	ACCESS_FLAGS=ACCESS_FLAGS+? \
WHERE \
	RESOURCE_ID=?
	
	
C_ACCESS_REMOVE_2=\
DELETE FROM \
	CMS_${PROJECT}_ACCESSCONTROL \
WHERE \
	RESOURCE_ID=? \
	AND PRINCIPAL_ID = ?
	
	
C_ACCESS_REMOVE_ALL_1=\
DELETE FROM \
	CMS_${PROJECT}_ACCESSCONTROL \
WHERE \
	RESOURCE_ID=?
	
C_ACCESS_REMOVE_ALL_FOR_PRINCIPAL_1=\
DELETE FROM \
	CMS_OFFLINE_ACCESSCONTROL \
WHERE \
	PRINCIPAL_ID=?

C_ACCESS_REMOVE_ALL_FOR_PRINCIPAL_ONLINE_1=\
DELETE FROM \
	CMS_ONLINE_ACCESSCONTROL \
WHERE \
	PRINCIPAL_ID=?


	
C_ACCESS_READ_ENTRY_2=\
SELECT \
	RESOURCE_ID,\
	PRINCIPAL_ID,\
	ACCESS_ALLOWED,\
	ACCESS_DENIED,\
	ACCESS_FLAGS \
FROM \
	CMS_${PROJECT}_ACCESSCONTROL \
WHERE \
	CMS_${PROJECT}_ACCESSCONTROL.RESOURCE_ID=? \
	AND CMS_${PROJECT}_ACCESSCONTROL.PRINCIPAL_ID = ?
	
		
C_ACCESS_READ_ENTRIES_1=\
SELECT \
	RESOURCE_ID,\
	PRINCIPAL_ID,\
	ACCESS_ALLOWED,\
	ACCESS_DENIED,\
	ACCESS_FLAGS \
FROM \
	CMS_${PROJECT}_ACCESSCONTROL \
WHERE \
	CMS_${PROJECT}_ACCESSCONTROL.RESOURCE_ID=?

	
C_SELECT_PUBLISHED_RESOURCES=\
SELECT \
	STRUCTURE_ID,\
	RESOURCE_ID,\
	RESOURCE_PATH,\
	RESOURCE_STATE,\
	RESOURCE_TYPE,\
	SIBLING_COUNT,\
	PUBLISH_TAG \
FROM \
	CMS_PUBLISH_HISTORY \
WHERE \
	HISTORY_ID=? \
ORDER BY \
	RESOURCE_TYPE ASC,\
	RESOURCE_STATE ASC,\
	RESOURCE_PATH ASC

C_DELETE_PUBLISH_HISTORY=\
DELETE FROM \
	CMS_PUBLISH_HISTORY \
WHERE \
	PUBLISH_TAG>=0 \
	AND PUBLISH_TAG<?
	
#
# Publish jobs
#
C_PUBLISHJOB_CREATE=\
INSERT INTO CMS_PUBLISH_JOBS \
	(HISTORY_ID,\
	PROJECT_ID,\
	PROJECT_NAME,\
	USER_ID,\
	PUBLISH_LOCALE,\
	PUBLISH_FLAGS,\
	RESOURCE_COUNT,\
	ENQUEUE_TIME,\
	START_TIME,\
	FINISH_TIME, \
	PUBLISH_LIST) \
VALUES \
	(?,?,?,?,?,?,?,?,?,?,?)
	
C_PUBLISHJOB_DELETE=\
DELETE FROM \
	CMS_PUBLISH_JOBS \
WHERE \
	HISTORY_ID=?
	
C_PUBLISHJOB_DELETE_PUBLISHLIST=\
UPDATE CMS_PUBLISH_JOBS SET \
	PUBLISH_LIST=NULL \
WHERE \
	HISTORY_ID=?
	
C_PUBLISHJOB_READ_JOBS_IN_TIMERANGE=\
SELECT \
	HISTORY_ID,\
	PROJECT_ID,\
	PROJECT_NAME,\
	USER_ID,\
	PUBLISH_LOCALE,\
	PUBLISH_FLAGS,\
	RESOURCE_COUNT,\
	ENQUEUE_TIME,\
	START_TIME,\
	FINISH_TIME \
FROM \
	CMS_PUBLISH_JOBS \
WHERE \
	FINISH_TIME>=? \
	AND FINISH_TIME<=? \
ORDER BY \
	ENQUEUE_TIME ASC	

C_PUBLISHJOB_READ_JOB=\
SELECT \
	HISTORY_ID,\
	PROJECT_ID,\
	PROJECT_NAME,\
	USER_ID,\
	PUBLISH_LOCALE,\
	PUBLISH_FLAGS,\
	RESOURCE_COUNT,\
	ENQUEUE_TIME,\
	START_TIME,\
	FINISH_TIME \
FROM \
	CMS_PUBLISH_JOBS \
WHERE \
	HISTORY_ID=?
	
C_PUBLISHJOB_READ_PUBLISHLIST=\
SELECT \
	HISTORY_ID, \
	PROJECT_ID, \
	PUBLISH_LIST \
FROM \
	CMS_PUBLISH_JOBS \
WHERE \
	HISTORY_ID=?	
	
C_PUBLISHJOB_READ_REPORT=\
SELECT \
	PUBLISH_REPORT \
FROM \
	CMS_PUBLISH_JOBS \
WHERE \
	HISTORY_ID=?
	
C_PUBLISHJOB_WRITE=\
UPDATE CMS_PUBLISH_JOBS SET \
	PROJECT_ID=?,\
	PROJECT_NAME=?,\
	USER_ID=?,\
	PUBLISH_LOCALE=?,\
	PUBLISH_FLAGS=?,\
	RESOURCE_COUNT=?,\
	ENQUEUE_TIME=?,\
	START_TIME=?,\
	FINISH_TIME=? \
WHERE \
	HISTORY_ID=?
	
C_PUBLISHJOB_WRITE_REPORT=\
UPDATE CMS_PUBLISH_JOBS SET \
	PUBLISH_REPORT=? \
WHERE \
	HISTORY_ID=?
	
#	
# Static export
#
C_STATICEXPORT_WRITE_PUBLISHED_LINKS=\
INSERT INTO CMS_STATICEXPORT_LINKS \
	(LINK_ID,\
	LINK_RFS_PATH,\
	LINK_TYPE,\
	LINK_PARAMETER,\
	LINK_TIMESTAMP) \
VALUES \
	(?,?,?,?,?)

   
C_STATICEXPORT_READ_PUBLISHED_RESOURCES=\
SELECT \
	COUNT(*) \
FROM \
	CMS_STATICEXPORT_LINKS \
WHERE \
	LINK_RFS_PATH=?    
	

C_STATICEXPORT_DELETE_PUBLISHED_LINKS=\
DELETE FROM \
	CMS_STATICEXPORT_LINKS \
WHERE \
	LINK_RFS_PATH=? \
	AND LINK_TYPE=? \
	AND LINK_PARAMETER=?	

 
C_STATICEXPORT_DELETE_ALL_PUBLISHED_LINKS=\
DELETE FROM \
	CMS_STATICEXPORT_LINKS \
WHERE \
	LINK_TYPE=? 	
  
C_STATICEXPORT_READ_ALL_PUBLISHED_LINKS=\
SELECT \
	LINK_RFS_PATH \
FROM \
	CMS_STATICEXPORT_LINKS \
WHERE \
	LINK_TYPE=? \
	AND LINK_TIMESTAMP>=? 
 
 
C_STATICEXPORT_READ_PUBLISHED_LINK_PARAMETERS=\
SELECT \
	LINK_PARAMETER \
FROM \
	CMS_STATICEXPORT_LINKS \
WHERE \
	LINK_RFS_PATH=?

C_SELECT_RESOURCES_FOR_PRINCIPAL_ATTR=\
(SELECT DISTINCT \
	${C_RESOURCES_SELECT_ATTRIBS} \
FROM \
	${C_RESOURCES_SELECT_TABLES} \
WHERE \
	CMS_${PROJECT}_RESOURCES.USER_CREATED=? \
	AND ${C_JOIN_STRUCTURE_RESOURCE}) \
UNION \
(SELECT DISTINCT \
	${C_RESOURCES_SELECT_ATTRIBS} \
FROM \
	${C_RESOURCES_SELECT_TABLES} \
WHERE \
	CMS_${PROJECT}_RESOURCES.USER_LASTMODIFIED=? \
	AND ${C_JOIN_STRUCTURE_RESOURCE}) 
	
C_SELECT_RESOURCES_FOR_PRINCIPAL_ACE=\
SELECT DISTINCT \
	${C_RESOURCES_SELECT_ATTRIBS} \
FROM \
	CMS_${PROJECT}_ACCESSCONTROL, \
	${C_RESOURCES_SELECT_TABLES} \
WHERE \
	CMS_${PROJECT}_ACCESSCONTROL.PRINCIPAL_ID=? \
	AND CMS_${PROJECT}_ACCESSCONTROL.RESOURCE_ID=CMS_${PROJECT}_RESOURCES.RESOURCE_ID \
	AND ${C_JOIN_STRUCTURE_RESOURCE} \
ORDER BY \
	CMS_${PROJECT}_STRUCTURE.RESOURCE_PATH ASC

C_RESOURCES_DELETE_PUBLISH_HISTORY_ENTRY=\
DELETE FROM \
    CMS_PUBLISH_HISTORY \
WHERE \
    HISTORY_ID = ? \
    AND PUBLISH_TAG = ? \
    AND STRUCTURE_ID = ? \
    AND RESOURCE_PATH = ?

#
# Content Relation Engine table columns
#
C_RELATION_SOURCE_ID=RELATION_SOURCE_ID
C_RELATION_SOURCE_PATH=RELATION_SOURCE_PATH
C_RELATION_TARGET_ID=RELATION_TARGET_ID
C_RELATION_TARGET_PATH=RELATION_TARGET_PATH
C_RELATION_DATE_BEGIN=RELATION_DATE_BEGIN
C_RELATION_DATE_END=RELATION_DATE_END
C_RELATION_TYPE=RELATION_TYPE
# All attributes to select
C_RELATIONS_SELECT_ATTRIBS=RELATION_SOURCE_ID,\
	RELATION_SOURCE_PATH,\
	RELATION_TARGET_ID,\
	RELATION_TARGET_PATH,\
	RELATION_DATE_BEGIN,\
	RELATION_DATE_END,\
	RELATION_TYPE

#
# Content Relation Engine filter conditions
#
C_RELATION_FILTER_SOURCE_ID=RELATION_SOURCE_ID = ?
C_RELATION_FILTER_SOURCE_PATH=RELATION_SOURCE_PATH LIKE ?
C_RELATION_FILTER_TARGET_ID=RELATION_TARGET_ID = ?
C_RELATION_FILTER_TARGET_PATH=RELATION_TARGET_PATH LIKE ?
C_RELATION_FILTER_DATE=RELATION_DATE_BEGIN < ? AND RELATION_DATE_END > ?
C_RELATION_FILTER_TYPE=RELATION_TYPE = ?

#
# Relation creation query
#
C_CREATE_RELATION=\
INSERT INTO CMS_${PROJECT}_RESOURCE_RELATIONS \
	(${C_RELATIONS_SELECT_ATTRIBS}) \
VALUES \
	(?,?,?,?,?,?,?)

C_READ_RELATIONS=\
SELECT DISTINCT \
	${C_RELATIONS_SELECT_ATTRIBS} \
FROM \
	CMS_${PROJECT}_RESOURCE_RELATIONS \
WHERE
# the conditions are build in the vfsdriver

C_MOVE_RELATIONS_SOURCE=\
UPDATE \
	CMS_${PROJECT}_RESOURCE_RELATIONS \
SET \
	RELATION_SOURCE_PATH=? \
WHERE \
	RELATION_SOURCE_ID=?

C_MOVE_RELATIONS_TARGET=\
UPDATE \
	CMS_${PROJECT}_RESOURCE_RELATIONS \
SET \
	RELATION_TARGET_PATH=? \
WHERE \
	RELATION_TARGET_ID=?

C_DELETE_RELATIONS=\
DELETE FROM \
    CMS_${PROJECT}_RESOURCE_RELATIONS \
WHERE
# the conditions are build in the vfsdriver

C_READ_STRUCTURE_STATE=\
SELECT \
    STRUCTURE_STATE \
FROM \
    CMS_${PROJECT}_STRUCTURE \
WHERE \
    STRUCTURE_ID = ?

C_READ_RESOURCE_STATE=\
SELECT \
    RESOURCE_STATE \
FROM \
    CMS_${PROJECT}_RESOURCES \
WHERE \
    RESOURCE_ID = ?
    
